(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[25],{945:function(e,t,i){Promise.resolve().then(i.bind(i,50999))},77205:function(e,t,i){"use strict";i.d(t,{_j:function(){return P},Jx:function(){return s},xo:function(){return n}});let r="2023-06-11";(s||(s={})).TOGGLE_THEME="toggle-theme";var s,a=i(64090);let o=a.createContext(null);o.displayName="SiteContextType";let n=()=>a.useContext(o);var l=i(43930),c=i(43233),d=i(85800),h=i(89539),p=i.n(h);function u(){return window.screen.width}function m(e){return e<d.eq.xs?"xs":e<d.eq.sm?"sm":e<d.eq.md?"md":e<d.eq.lg?"lg":e<d.eq.xl?"xl":"xlPlus"}class g{get level(){return this._level}get name(){return this._name}setLevel(e){null!=e&&(this._levle=e)}write(e){console.log(e)}debug(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];console.debug(this.format(e,i))}verbose(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];console.log(this.format(e,i))}info(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];console.info(this.format(e,i))}warn(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];console.warn(this.format(e,i))}error(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];console.error(this.format(e,i))}fatal(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];console.error(this.format(e,i))}format(e,t){let i=(0,l.A3)(this._level),r=p()().format("YYYY-MM-DD HH:mm:ss"),s="["+this.name+"]",a="string"==typeof e?e:"",o=[];if("string"!=typeof e){let t=this.formatData(e);o.push(t)}for(let e of t){let t=this.formatData(e);o.push(t)}let n=0,c=o.length>0?a.replace(this._placeholderRegex,e=>{let t=o[n];return n+=1,void 0===t?e:t}):a;for(let e=n;e<o.length;++e)c+=" "+o[e];return r+" "+i+" "+s+" "+c}formatData(e){var t,i;let r=this._inline,s="function"==typeof e?e():"function"==typeof(null==e?void 0:e.toJSON)?e.toJSON():e;if(null===s)return"null";if(void 0===s)return"undefined";switch(typeof s){case"string":return r?s.replace(/\s*\n\s*/g," "):s;case"boolean":return s?"true":"false";case"number":return String(s)}return s instanceof Error?null!==(i=null!==(t=s.stack)&&void 0!==t?t:s.message)&&void 0!==i?i:s.name:r?JSON.stringify(s,null,0):JSON.stringify(s,null,2)}constructor(e){let{level:t,name:i,inline:r=!0,placeholderRegex:s=RegExp("(?<!\\\\)\\{\\}","g")}=e;this._level=t,this._name=i,this._inline=r,this._placeholderRegex=s}}let v=new g({name:"waw",level:c.H.ERROR}),f={author:{name:"guanghechen",motto:"有花满渚、有酒盈瓯",avatar:"",github:"https://github.com/guanghechen",rss:"/rss.xml",about:"/about"},copyright:{date:"2017-".concat(new Date().getFullYear())},description:"guanghechen's personal site",reporter:v,screenWidth:u(),screenBreakpoint:m(u()),siteUrl:"https://guanghechen.github.io",theme:d.Q2.light,title:"guanghechen"};var y=i(96827);class b{constructor(e){this.toggleTheme=e=>{this.viewmodel.theme$.next(e)},this.viewmodel=e.viewmodel}}class k extends y.jz{constructor(e){super(),this.getSnapshot=()=>({author:{...this.author$.getSnapshot()},copyright:{...this.copyright$.getSnapshot()},description:this.description$.getSnapshot(),reporter:this.reporter$.getSnapshot(),screenWidth:this.screenWidth$.getSnapshot(),screenBreakpoint:this.screenBreakpoint$.getSnapshot(),siteUrl:this.siteUrl$.getSnapshot(),theme:this.theme$.getSnapshot(),title:this.title$.getSnapshot()}),this.dispatch=e=>{let t=C[e.type];t?t(this._controller,e):console.error(this.constructor.name,"Unhandled action:",e)};let{author:t,copyright:i,description:r,reporter:s,siteUrl:a,title:o,theme:n}=e;this.author$=new y.ZM({...t}),this.copyright$=new y.ZM({...i}),this.description$=new y.ZM(r),this.reporter$=new y.ZM(s),this.screenWidth$=new y.ZM(u()),this.siteUrl$=new y.ZM(a),this.theme$=new y.ZM(n),this.title$=new y.ZM(o),this.screenBreakpoint$=y.D0.fromObservables([this.screenWidth$],e=>{let[t]=e;return m(t)});let l=new b({viewmodel:this});this._controller=l}}let C={[s.TOGGLE_THEME]:(e,t)=>{let i=t.payload;e.toggleTheme(i)}};var N=i(94026),S=i(40308),R=i(51326),w=i(26813);let P=(0,d.Um)({displayName:"PersistentSiteContextProvider",version:r,disposeWhenUnmounted:!0,Provider:o.Provider,Persistent:e=>{let{viewmodel:t,storage:i,storageKey:s}=e,o=(0,w.sD)(t,["theme$"]),n=a.useMemo(()=>(0,S.P2)(()=>{let e={theme:t.theme$.getSnapshot()};return t.reporter$.getSnapshot().debug("saving {}. data:",s,e),i.save({version:r,data:e})},100),[t,i,s]);return a.useEffect(()=>void n(),[n,o]),(0,R.i7)(n,!1),(0,N.tZ)(a.Fragment,{})},SideEffect:e=>{let{viewmodel:t}=e;return a.useEffect(()=>{let e=()=>{let e=u();t.screenWidth$.next(e)};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[t]),(0,N.tZ)(a.Fragment,{})},ViewModel:k,initContextState:function(e){var t,i,r,s,a,o,n;let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f,{author:c,copyright:d,title:h,description:p,siteUrl:g,theme:v,reporter:y}=null!=e?e:{};return{author:{name:null!==(t=null==c?void 0:c.name)&&void 0!==t?t:l.author.name,motto:null!==(i=null==c?void 0:c.motto)&&void 0!==i?i:l.author.motto,avatar:null!==(r=null==c?void 0:c.avatar)&&void 0!==r?r:l.author.avatar,github:null!==(s=null==c?void 0:c.github)&&void 0!==s?s:l.author.github,rss:null!==(a=null==c?void 0:c.rss)&&void 0!==a?a:l.author.rss,about:null!==(o=null==c?void 0:c.about)&&void 0!==o?o:l.author.about},copyright:{date:null!==(n=null==d?void 0:d.date)&&void 0!==n?n:l.copyright.date},description:null!=p?p:l.description,reporter:null!=y?y:l.reporter,screenWidth:u(),screenBreakpoint:m(u()),siteUrl:null!=g?g:l.siteUrl,theme:null!=v?v:l.theme,title:null!=h?h:l.title}}})},58227:function(e,t,i){"use strict";i.d(t,{p:function(){return l},X:function(){return s}}),(r=s||(s={}))[r.PENDING=1]="PENDING",r[r.RUNNING=2]="RUNNING",r[r.PAUSED=4]="PAUSED",r[r.END=8]="END";var r,s,a=i(88706),o=i(96827),n=i(85800);class l extends o.jz{constructor(e){super();let t=new o.ZM(e.status),i=new o.ZM(e.elapsedTime),r=Date.now(),l=(e,t)=>{let a=Date.now();if(t===s.RUNNING){let e=a-r;i.setState(t=>t+e)}else e===s.PENDING&&i.setState(0);r=a};t.subscribe({next:(e,t)=>l(e,t),complete:()=>{}});let c=(0,n.iP)(()=>{let e=t.getSnapshot();l(e,e)});this.status$=t,this.elapsedTime$=i,this.registerDisposable(a.JT.fromCallback(c))}}},50999:function(e,t,i){"use strict";i.r(t),i.d(t,{GameGomokuPageView:function(){return ty}});var r,s,a,o,n,l,c,d,h,p,u,m,g=i(94026),v=i(64090),f=i(26813),y=i(77205),b=i(40663),k=i(85800),C=i(41848),N=i(10571),S=i(80165),R=i(68148),w=i(76718),P=i(74404),x=i.n(P),I=i(32997);class E extends v.Component{shouldComponentUpdate(e,t){let i=this.props;return this.state.prefer!==t.prefer||i.imageInputId!==e.imageInputId||i.background!==e.background||i.visible!==e.visible||i.disabled!==e.disabled||i.className!==e.className}render(){let{onClosePicker:e,onColorChange:t,onImageChange:i,onPickerClicked:r,onPreferChange:s}=this,{imageInputId:a,background:o,visible:n,className:l}=this.props,{prefer:c}=this.state;return(0,g.BX)("div",{className:(0,b.cx)(D.container,!n&&D.invisible,l),onClick:r,children:[(0,g.tZ)("div",{className:D.cover,onClick:e}),(0,g.BX)("div",{className:D.backgroundPicker,children:[(0,g.tZ)("div",{className:D.backgroundPrefer,children:(0,g.tZ)(C.Z,{style:{display:"flex",justifyContent:"center"},children:(0,g.BX)(N.Z,{className:D.backgroundRadioGroup,value:c,onChange:s,children:[(0,g.tZ)(S.Z,{value:"color",control:(0,g.tZ)(R.Z,{}),label:"color"}),(0,g.tZ)(S.Z,{value:"image",control:(0,g.tZ)(R.Z,{}),label:"image"})]})})}),(0,g.BX)("div",{children:[(0,g.tZ)("div",{className:(0,b.cx)(D.colorPickerWrapper,"color"!==c&&D.invisible),onDoubleClick:e,children:(0,g.tZ)(I.xS,{className:D.colorPicker,color:o.color,onChange:t})}),(0,g.BX)("div",{className:(0,b.cx)(D.imagePickerWrapper,"image"!==c&&D.invisible),children:[(0,g.tZ)("input",{type:"file",accept:"image/*",id:a,style:{display:"none"},multiple:!1,disabled:this.props.disabled,onChange:i}),(0,g.tZ)("label",{htmlFor:a,children:(0,g.tZ)(w.Z,{className:D.imageUploadBtn,variant:"contained",component:"span",children:(0,g.tZ)("img",{alt:"background",src:o.imageUrl})})})]})]})]})]})}constructor(e){super(e),this.onClosePicker=()=>{this.props.onVisibleChange(!1)},this.onColorChange=e=>{if(this.props.disabled)return;let{background:t,onBackgroundChange:i}=this.props;i({prefer:"color",imageUrl:t.imageUrl,color:e.rgb})},this.onImageChange=e=>{if(this.props.disabled)return;let{background:t,onBackgroundChange:i}=this.props,r=e.target.files;if(null!==r){let e=new FileReader;e.readAsDataURL(r[0]),e.onload=e=>{var r;let s=null===(r=e.target)||void 0===r?void 0:r.result;null!=s&&i({prefer:"image",color:t.color,imageUrl:String(s)})}}},this.onPickerClicked=e=>{e.stopPropagation()},this.onPreferChange=(e,t)=>{if(t!==this.state.prefer){let{background:e,onBackgroundChange:i}=this.props;this.setState({prefer:t}),("color"===t&&e.color||"image"===t&&e.imageUrl)&&i({prefer:t,color:e.color,imageUrl:e.imageUrl})}},this.state={prefer:e.background.prefer}}}E.displayName="BackgroundPickerComponent",E.propTypes={imageInputId:x().string.isRequired,background:x().any.isRequired,visible:x().bool.isRequired,disabled:x().bool.isRequired,className:x().string,onVisibleChange:x().func.isRequired,onBackgroundChange:x().func.isRequired};let D={container:(0,b.iv)({position:"absolute",zIndex:20,top:"20px"}),invisible:(0,b.iv)({"&&":{display:"none",visibility:"hidden"}}),cover:(0,b.iv)({position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px",cursor:"default"}),backgroundPicker:(0,b.iv)({display:"flex",flexDirection:"column",minWidth:"220px",border:"1px solid var(--colorBorderPicker, #e6e6e6)",borderRadius:"4px",boxShadow:"rgba(0, 0, 0, 0.15) 0px 0px 0px 1px, rgba(0, 0, 0, 0.15) 0px 8px 16px"}),backgroundPrefer:(0,b.iv)({flex:"0 0 auto",borderBottom:"1px solid var(--colorBorderPicker, #e6e6e6)",userSelect:"none"}),backgroundRadioGroup:(0,b.iv)({"&&":{display:"flex",flexDirection:"row",justifyContent:"center"}}),imagePickerWrapper:(0,b.iv)({boxSizing:"border-box",display:"flex",justifyContent:"center",alignItems:"center",width:"220px",height:"220px","& img":{display:"inline-block",width:"200px",height:"200px"}}),colorPickerWrapper:(0,b.iv)({display:"block"}),colorPicker:(0,b.iv)({border:"none !important",borderRadius:"0px !important",boxShadow:"none !important",background:"var(--colorBgPicker, #fff) !important",color:"var(--colorPicker, #333) !important",caretColor:"transparent",label:{color:"var(--colorPicker, #333) !important"}}),imageUploadBtn:(0,b.iv)({"&&":{background:"none",padding:"0px",margin:"0px"}})},T=e=>{let{background:t,visible:i,disabled:r,className:s,onBackgroundChange:a,onVisibleChange:o}=e,n=v.useId();return(0,g.tZ)(E,{imageInputId:n,background:t,visible:i,disabled:r,className:s,onBackgroundChange:a,onVisibleChange:o})};class Z extends v.Component{shouldComponentUpdate(e){let t=this.props;return t.visible!==e.visible||t.color!==e.color||t.className!==e.className}render(){let{color:e,visible:t,className:i}=this.props,{onColorChange:r,onClosePicker:s}=this;return(0,g.BX)("div",{className:(0,b.cx)(M.container,!t&&M.invisible,i),children:[(0,g.tZ)("div",{className:M.cover,onClick:s}),(0,g.tZ)("div",{className:M.picker,onDoubleClick:s,children:(0,g.tZ)(I.xS,{className:M.colorPicker,color:e,onChange:r})})]})}constructor(...e){super(...e),this.onColorChange=e=>{this.props.onColorChange(e.rgb)},this.onClosePicker=()=>{this.props.onVisibleChange(!1)}}}Z.displayName="ColorPicker",Z.propTypes={visible:x().bool.isRequired,color:x().any.isRequired,className:x().string,onVisibleChange:x().func.isRequired,onColorChange:x().func.isRequired};let M={container:(0,b.iv)({position:"absolute",zIndex:20,top:"20px",display:"block",visibility:"visible"}),invisible:(0,b.iv)({"&&":{display:"none",visibility:"hidden"}}),cover:(0,b.iv)({position:"fixed",top:0,right:0,bottom:0,left:0}),picker:(0,b.iv)({display:"flex",flexDirection:"column",minWidth:"220px",border:"1px solid var(--colorBorderPicker, #e6e6e6)",borderRadius:"4px",boxShadow:"rgba(0, 0, 0, 0.15) 0px 0px 0px 1px, rgba(0, 0, 0, 0.15) 0px 8px 16px"}),colorPicker:(0,b.iv)({border:"none !important",borderRadius:"0 !important",boxShadow:"none !important",background:"var(--colorBgPicker, #fff) !important",color:"var(--colorPicker, #333) !important",caretColor:"transparent",label:{color:"var(--colorPicker, #333) !important"}})};var $=i(93234);l||(l={}),(r=c||(c={})).colorBgOverlay="--colorBgOverlay",r.colorBgPicker="--colorBgPicker",r.colorBgSwatch="--colorBgSwatch",r.colorBorderPicker="--colorBorderPicker",r.colorButton="--colorButton",r.colorOverlayEnd="--colorOverlayEnd",r.colorPicker="--colorPicker",r.colorPlayerName="--colorPlayerName",r.colorPlayerType="--colorPlayerType",r.colorThinkingIcon="--colorThinkingIcon",r.colorVersus="--colorVersus",r.colorWinnerName="--colorWinnerName",(s=d||(d={})).colorBgOverlay="var(--colorBgOverlay)",s.colorBgPicker="var(--colorBgPicker)",s.colorBgSwatch="var(--colorBgSwatch)",s.colorBorderPicker="var(--colorBorderPicker)",s.colorButton="var(--colorButton)",s.colorOverlayEnd="var(--colorOverlayEnd)",s.colorPicker="var(--colorPicker)",s.colorPlayerName="var(--colorPlayerName)",s.colorPlayerType="var(--colorPlayerType)",s.colorThinkingIcon="var(--colorThinkingIcon)",s.colorVersus="var(--colorVersus)",s.colorWinnerName="var(--colorWinnerName)";class _ extends v.Component{shouldComponentUpdate(e,t){let i=this.props;return this.state.isPickerVisible!==t.isPickerVisible||i.position!==e.position||i.name!==e.name||i.type!==e.type||i.disabled!==e.disabled||i.thinking!==e.thinking||i.running!==e.running||i.avatar!==e.avatar||i.className!==e.className}render(){let{onAvatarClick:e,onAvatarChange:t,onVisibleChange:i,onEdit:r}=this,{name:s,type:a,avatar:o,className:n}=this.props,{isPickerVisible:l}=this.state,c=A(this.props.position,this.props.avatar,this.props.disabled,this.props.thinking,this.props.running);return(0,g.BX)("div",{className:(0,b.cx)(c.container,n),onClick:r,children:[(0,g.BX)("div",{className:c.userWrapper,children:[(0,g.tZ)("span",{className:c.name,children:s}),(0,g.tZ)("span",{className:c.type,children:a})]}),(0,g.tZ)("div",{className:c.avatar,onClick:e,children:(0,g.tZ)($.Z,{className:c.thinkingIcon})}),(0,g.tZ)(T,{className:c.picker,visible:l,disabled:this.props.disabled,background:o,onVisibleChange:i,onBackgroundChange:t})]})}componentDidMount(){window.addEventListener("click",this.closePicker)}componentWillUnmount(){window.removeEventListener("click",this.closePicker)}constructor(e){super(e),this.onAvatarClick=e=>{e.stopPropagation(),this.setState({isPickerVisible:!0})},this.onAvatarChange=e=>{this.props.onAvatarChange(e)},this.onVisibleChange=e=>{this.setState({isPickerVisible:e})},this.onEdit=e=>{e.stopPropagation(),this.props.onEdit()},this.onContainerClick=e=>{e.stopPropagation()},this.closePicker=()=>{this.setState({isPickerVisible:!1})},this.state={isPickerVisible:!1}}}_.displayName="$DuelPlayer",_.propTypes={position:x().oneOf(["left","right"]).isRequired,name:x().string.isRequired,type:x().string.isRequired,disabled:x().bool.isRequired,thinking:x().bool.isRequired,running:x().bool.isRequired,avatar:x().object.isRequired,className:x().string,onEdit:x().func.isRequired,onAvatarChange:x().func.isRequired};let A=(e,t,i,r,s)=>({container:(0,b.iv)({position:"relative",display:"flex",flexDirection:"left"===e?"row":"row-reverse",justifyContent:"flex-end",alignItems:"center",lineHeight:"16px",cursor:i?"default":"pointer"}),avatar:(0,b.iv)({position:"relative",width:32,height:32,borderRadius:"50%",margin:"left"===e?"0 0 0 6px":"0 6px 0 0",background:(0,k.l9)(t),backgroundSize:"cover"}),userWrapper:(0,b.iv)({display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"left"===e?"flex-end":"flex-start",lineHeight:"16px"}),name:(0,b.iv)({display:"flex",alignItems:"center",color:d.colorPlayerName,fontWeight:"bold",fontSize:16,userSelect:"none"}),thinkingIcon:(0,b.iv)({"&&":{position:"absolute",top:0,left:"left"===e?void 0:-20,right:"left"===e?-20:void 0,display:"inline-block",visibility:r?"visible":"hidden",transition:"translate(0, -50%)",width:16,height:16,color:d.colorThinkingIcon,userSelect:"none",animation:s?"1s ease-in 0s ".concat(X.thinkingIcon," infinite alternate both"):void 0}}),type:(0,b.iv)({margin:"4px 0",color:d.colorPlayerType,fontSize:14,userSelect:"none"}),picker:(0,b.iv)({"&&":"left"===e?{top:48,left:16}:{top:48,left:"unset",right:16},color:"var(--colorPicker, #333)",background:"var(--colorBgPicker, #fff)"})}),X={thinkingIcon:(0,b.F4)({"0%":{transform:"rotate(-30deg) scale(1.0)"},"50%":{transform:"rotate(0deg) scale(1.2)"},"100%":{transform:"rotate(30deg) scale(1.0)"}})};var O=i(51326),U=i(58227),B=i(35984);let q="2023-07-25";(a=h||(h={})).FLIP_PLAYER="@gomoku/flip-player",a.MODIFY_PLAYER="@gomoku/modify-player",a.MODIFY_PREFERENCE="@gomoku/modify-preference",a.MOVE="@gomoku/move",a.PAUSE="@gomoku/pause",a.RESET="@gomoku/reset",a.RESTART="@gomoku/restart",a.RESUME="@gomoku/resume",a.RETRACT="@gomoku/retract",a.START="@gomoku/start",(o=p||(p={})).MOVE="move",o.RETRACT="retract",(n=u||(u={})).HUMAN="human",n.COMPUTER="computer",n.STUPID_COMPUTER="stupid-computer";let G=v.createContext(null);G.displayName="GomokuContextType";let F=()=>v.useContext(G);var W=i(27628);let V=W.a7.rightHalf,L=e=>e===u.COMPUTER||e===u.STUPID_COMPUTER;function z(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,s=new Int32Array(t*i).fill(-1);for(let{r:i,c:r,p:a}of e)s[i*t+r]=a;let a=(e,i)=>e*t+i,o=(e,r)=>e>=0&&e<t&&r>=0&&r<i;for(let e of V){let[n,l]=W.bs[e];for(let e=0;e<t;++e)for(let t=0;t<i;++t){let i=s[a(e,t)];if(i<0)continue;let c=1;for(let r=e+n,d=t+l;o(r,d)&&s[a(r,d)]===i;r+=n,d+=l)c+=1;if(c>=r){if(0!==i&&1!==i)throw Error("[checkWinner] Bad player(".concat(i,") on piece (").concat(e,", ").concat(t,")."));return i}}}return -1}class j{constructor(e){this.restart=()=>{let e=this.viewmodel;e.status$.getSnapshot()!==U.X.PENDING&&(e.status$.next(U.X.PENDING),e.winner$.next(-1),e.mover$.next(0),e.pieces$.next(B.aV.of()),e.instructions$.next(B.aV.of()),e.gameTick$.setState(e=>e+1),e.attemptTick$.next(0))},this.reset=(e,t)=>{let i=this.viewmodel;i.status$.getSnapshot()===U.X.PENDING&&(e&&i.MAX_ROW$.next(e),t&&i.MAX_COL$.next(t),i.status$.next(U.X.PENDING),i.winner$.next(-1),i.mover$.next(0),i.pieces$.next(B.aV.of()),i.instructions$.next(B.aV.of()),i.gameTick$.setState(e=>e+1),i.attemptTick$.next(0))},this.start=()=>{let e=this.viewmodel;e.status$.getSnapshot()===U.X.PENDING&&e.status$.next(U.X.RUNNING)},this.pause=()=>{let e=this.viewmodel;e.status$.getSnapshot()===U.X.RUNNING&&e.status$.next(U.X.PAUSED)},this.resume=()=>{let e=this.viewmodel;e.status$.getSnapshot()===U.X.PAUSED&&e.status$.next(U.X.RUNNING)},this.move=(e,t)=>{let i=this.viewmodel;if(i.status$.getSnapshot()!==U.X.RUNNING)return;let r=i.pieces$.getSnapshot();if(r.some(i=>i.r===e&&i.c===t))return;let s=i.MAX_ROW$.getSnapshot(),a=i.MAX_COL$.getSnapshot(),o=i.mover$.getSnapshot(),n={r:e,c:t,p:o},l=r.push(n),c=z(l,s,a);(c>=0||l.size===s*a)&&i.status$.next(U.X.END),i.winner$.next(c),i.pieces$.next(l),i.mover$.next(1^o),i.attemptTick$.setState(e=>e+1),i.instructions$.setState(e=>e.push({type:p.MOVE,payload:n,timestamp:new Date().toISOString()}))},this.retract=()=>{let e=this.viewmodel,t=e.status$.getSnapshot();if(t!==U.X.RUNNING&&t!==U.X.END)return;let i=e.mover$.getSnapshot(),r=e.pieces$.getSnapshot(),s=r.findLastIndex(e=>e.p===i);if(s<0)return;let a=r.size-s,o=r.slice(0,s),n=1&o.size;e.status$.next(U.X.RUNNING),e.pieces$.next(o),e.winner$.next(-1),e.mover$.next(n),e.attemptTick$.setState(e=>e+1),e.instructions$.setState(e=>e.push({type:p.RETRACT,payload:a,timestamp:new Date().toISOString()}))},this.flipPlayer=()=>{let e=this.viewmodel;if(e.status$.getSnapshot()!==U.X.PENDING)return;let[t,i]=e.players$.getSnapshot();e.players$.next([i,t])},this.modifyPlayer=e=>{var t,i,r,s;let a=this.viewmodel;if(a.status$.getSnapshot()===U.X.END)return;if(0!==e.id&&1!==e.id){console.error("[Bad action] modifyPlayer",e);return}let o=a.players$.getSnapshot()[e.id],n={name:e.name||o.name,type:e.type||o.type,preference:{pieceFillStyle:null!==(r=null===(t=e.preference)||void 0===t?void 0:t.pieceFillStyle)&&void 0!==r?r:o.preference.pieceFillStyle,pieceStrokeStyle:null!==(s=null===(i=e.preference)||void 0===i?void 0:i.pieceStrokeStyle)&&void 0!==s?s:o.preference.pieceStrokeStyle}};a.players$.setState(t=>t.map((t,i)=>i===e.id?n:t))},this.modifyPreference=e=>{let t=this.viewmodel;t.status$.getSnapshot()!==U.X.END&&t.preference$.setState(t=>({...t,...e}))},this.viewmodel=e.viewmodel}}let H={MAX_ROW:15,MAX_COL:15,status:U.X.PENDING,elapsedTime:0,winner:-1,mover:0,pieces:[],instructions:[],gameTick:0,attemptTick:0,players:[{name:"guanghechen",type:u.COMPUTER,preference:{pieceFillStyle:{prefer:"image",imageUrl:"/asset/img/gomoku/guanghechen.jpg"}}},{name:"wulala",type:u.HUMAN,preference:{pieceFillStyle:{prefer:"image",imageUrl:"/asset/img/gomoku/wulala.jpg"}}}],preference:{borderColor:{r:255,g:255,b:255,a:1},locatePointColor:{r:51,g:51,b:51,a:1},boardBackground:{prefer:"color",color:{r:230,g:226,b:222,a:1},imageUrl:"/asset/img/gomoku/board.jpg"}}};class Y extends U.p{constructor(e){super(e),this.getSnapshot=()=>({status:this.status$.getSnapshot(),elapsedTime:this.elapsedTime$.getSnapshot(),MAX_ROW:this.MAX_ROW$.getSnapshot(),MAX_COL:this.MAX_COL$.getSnapshot(),winner:this.winner$.getSnapshot(),mover:this.mover$.getSnapshot(),pieces:Array.from(this.pieces$.getSnapshot()),instructions:Array.from(this.instructions$.getSnapshot()),gameTick:this.gameTick$.getSnapshot(),attemptTick:this.attemptTick$.getSnapshot(),players:this.players$.getSnapshot(),preference:this.preference$.getSnapshot()}),this.dispatch=e=>{let t=K[e.type];t?t(this._controller,e):console.error(this.constructor.name,"Unhandled action:",e)},this.MAX_ROW$=new f.ZM(e.MAX_ROW),this.MAX_COL$=new f.ZM(e.MAX_COL),this.winner$=new f.ZM(e.winner),this.mover$=new f.ZM(e.mover),this.pieces$=new f.ZM(B.aV.of(...e.pieces)),this.instructions$=new f.ZM(B.aV.of(...e.instructions)),this.gameTick$=new f.ZM(e.gameTick),this.attemptTick$=new f.ZM(e.attemptTick),this.players$=new f.ZM(e.players),this.preference$=new f.ZM(e.preference);let t=new j({viewmodel:this});this._controller=t}}let K={[h.RESTART]:e=>{e.restart()},[h.RESET]:(e,t)=>{var i;let{MAX_ROW:r,MAX_COL:s}=null!==(i=t.payload)&&void 0!==i?i:{};e.reset(r,s)},[h.START]:e=>{e.start()},[h.PAUSE]:e=>{e.pause()},[h.RESUME]:e=>{e.resume()},[h.RETRACT]:e=>{e.retract()},[h.MOVE]:(e,t)=>{let{r:i,c:r}=t.payload;e.move(i,r)},[h.FLIP_PLAYER]:e=>{e.flipPlayer()},[h.MODIFY_PLAYER]:(e,t)=>{let i=t.payload;e.modifyPlayer(i)},[h.MODIFY_PREFERENCE]:(e,t)=>{let i=t.payload;e.modifyPreference(i)}},J=2*Math.PI;class Q{init(e){var t;this.canvas=e,window.addEventListener("resize",this.onresize),null===(t=this.canvas)||void 0===t||t.addEventListener("click",this.onclick),this.onresize()}reset(e){null!=e.GOMOKU_SIZE&&(this.GOMOKU_SIZE=e.GOMOKU_SIZE),null!=e.pieceDrawer&&(this.pieceDrawer=e.pieceDrawer),null!=e.styles&&(this.styles={...this.styles,...e.styles}),this.canvas!==e.canvas&&(console.log("destroying canvas"),this.destroy(),this.init(e.canvas)),this.onresize()}destroy(){var e;window.removeEventListener("resize",this.onresize),null===(e=this.canvas)||void 0===e||e.removeEventListener("click",this.onclick)}async draw(e){let{_drawingStatus:t}=this;if(t.drawing){t.requesting=!0,t.requestData=[e];return}t.drawing=!0,this.pieces=e;try{let{canvas:e,bufferCanvas:t}=this,i=null==e?void 0:e.getContext("2d");if(null==e||null==i)return;let{width:r,height:s}=e;t.width=r,t.height=s;let a=t.getContext("2d");null!=a?(a.clearRect(0,0,r,s),await this._drawAll(a),i.clearRect(0,0,r,s),i.drawImage(t,0,0)):(i.clearRect(0,0,r,s),await this._drawAll(i))}finally{t.drawing=!1,t.requesting&&(t.requesting=!1,await this.draw(...t.requestData))}}async _drawAll(e){this._drawBoard(e),this._drawLocatePoints(e),await this._drawPieces(e),this._drawLastPlacedHighlight(e),this._drawActivatedCellHighlight(e)}_drawBoard(e){let{lineWidth:t,farTop:i,farRight:r,farBottom:s,farLeft:a,gridSize:o,styles:n}=this,l=o+t;e.lineWidth=t,e.strokeStyle=n.gridLineColor,e.beginPath();for(let t=i;t<=s;t+=l)e.moveTo(t,a),e.lineTo(t,r);for(let t=a;t<=r;t+=l)e.moveTo(i,t),e.lineTo(s,t);e.closePath(),e.stroke()}_drawLocatePoints(e){let{lineWidth:t,GOMOKU_SIZE:i,styles:r}=this,s=i-1>>1,a=s%4==0?4:s%4,o=t+6>>1;e.fillStyle=r.locatePointColor;for(let t=a;t+1<i;t+=4)for(let r=a;r+1<i;r+=4){let{x:i,y:s}=this.position(t,r);e.beginPath(),e.arc(i,s,o,0,J,!1),e.closePath(),e.stroke(),e.fill()}}async _drawPieces(e){if(null==this.pieceDrawer)return;let{GOMOKU_SIZE:t,pieceDrawer:i,pieceRadius:r,pieces:s}=this,a=[],o=[];for(let{r:e,c:i,p:r}of s)if(e>=0&&e<t&&i>=0&&i<t){let t=this.position(e,i);0===r?a.push(t):1===r&&o.push(t)}await Promise.allSettled([i.drawPieces(e,0,r,a),i.drawPieces(e,1,r,o)])}_drawLastPlacedHighlight(e){let t=this.pieces.get(-1);if(void 0===t)return;let{r:i,c:r}=t,{GOMOKU_SIZE:s,pieceRadius:a,activateCell:o}=this;if((i!==o.r||r!==o.c)&&i>=0&&i<s&&r>=0&&r<s){let{x:t,y:s}=this.position(i,r);e.setLineDash([5,3]),e.lineWidth=1,e.strokeStyle="#c80000",e.beginPath(),e.arc(t,s,a+4,0,J,!1),e.closePath(),e.stroke(),e.setLineDash([])}}_drawActivatedCellHighlight(e){let{GOMOKU_SIZE:t,activateCell:i,pieceRadius:r}=this,{r:s,c:a}=i;if(s>=0&&s<t&&a>=0&&a<t){let{x:t,y:i}=this.position(s,a);e.setLineDash([5,3]),e.lineWidth=1,e.strokeStyle="blue",e.beginPath(),e.arc(t,i,r+4,0,J,!1),e.closePath(),e.stroke(),e.setLineDash([])}}locate(e,t){let{GOMOKU_SIZE:i,pieceRadius:r}=this,s=this.gridSize+this.lineWidth,a=e-this.farLeft,o=t-this.farTop,n=Math.floor(o/s),l=Math.floor(a/s),c=a-l*s,d=o-n*s;return 2*c>s&&(l+=1,c=s-c),2*d>s&&(n+=1,d=s-d),n>=0&&n<i&&l>=0&&l<i&&Math.abs(c)<=r&&Math.abs(d)<=r?{r:n,c:l}:{r:-1,c:-1}}position(e,t){let{lineWidth:i,gridSize:r,farLeft:s,farTop:a}=this,o=r+i;return{x:s+t*o,y:a+e*o}}updateActivateCell(e,t){this.activateCell.r=e,this.activateCell.c=t,this.draw(this.pieces)}constructor(e){var t,i,r,s,a;this.canvas=null,this.pieceDrawer=null,this.pieceRadius=0,this.gridSize=0,this.farTop=0,this.farRight=0,this.farBottom=0,this.farLeft=0,this.activateCell={r:-1,c:-1},this._drawingStatus={drawing:!1,requesting:!1,requestData:[B.aV.of()]},this.onresize=()=>{let{canvas:e,GOMOKU_SIZE:t,lineWidth:i}=this;if(null==e)return;let r=e.parentElement;if(null!=r){var s;let a=Math.min(r.clientWidth,r.clientHeight),o=i*t,n=Math.floor((a-o)/(t+.2));if(n<12)throw TypeError("Canvas is not large enough. clientWidth(".concat(r.clientWidth,"), clientHeight(").concat(r.clientHeight,")"));e.width=a,e.height=a;let l=a-o-n*(t-1);this.farLeft=this.farTop=Math.floor(l/2),this.farRight=this.farBottom=a-(l-this.farLeft),this.gridSize=n;let c=Math.round((this.lineWidth+16)/2)+1;this.pieceRadius=null!==(s=this.__customPieceRadius)&&void 0!==s?s:Math.floor(Math.min(.4*n,Math.max(.3*this.gridSize,c))),this.draw(this.pieces)}},this.onclick=e=>{let{GOMOKU_SIZE:t}=this,{offsetX:i,offsetY:r}=e,{r:s,c:a}=this.locate(i,r);if(s>=0&&s<t&&a>=0&&a<t){var o,n;this.updateActivateCell(s,a),null===(o=(n=this.listeners).onClick)||void 0===o||o.call(n,s,a)}},this.GOMOKU_SIZE=e.lines,this.pieces=e.pieces,this.lineWidth=null!==(r=e.lineWidth)&&void 0!==r?r:1,this.pieceDrawer=e.pieceDrawer,this.listeners={...e.listeners},this.bufferCanvas=document.createElement("canvas"),this.styles={gridLineColor:null!==(s=null===(t=e.styles)||void 0===t?void 0:t.gridLineColor)&&void 0!==s?s:"#492d15",locatePointColor:null!==(a=null===(i=e.styles)||void 0===i?void 0:i.locatePointColor)&&void 0!==a?a:"#333333"},this.__customPieceRadius=e.pieceRadius,this.init(e.canvas)}}class ee{drawPieces(e,t,i,r){let s=2*i,{pieceFillStyle:a,pieceStrokeStyle:o}=this.getPreferenceSettings(t),n=null!=o?(0,k.xv)(o):"";switch(n&&(e.strokeStyle=n),a.prefer){case"color":for(let{x:t,y:s}of((0,k.kG)(null!=a.color,"[drawPiece] color is not defined"),e.fillStyle=(0,k.xv)(a.color),r))e.beginPath(),e.arc(t,s,i,0,J,!1),e.closePath(),e.stroke(),e.fill();return Promise.resolve();case"image":{(0,k.kG)(null!=a.imageUrl,"[drawPiece] imageUrl is not defined");let t=document.createElement("img");return t.src=a.imageUrl,new Promise(a=>{t.onload=()=>{for(let{x:a,y:o}of r)e.save(),e.beginPath(),e.arc(a,o,i,0,J,!1),e.closePath(),e.clip(),e.drawImage(t,0,0,t.width,t.height,a-i,o-i,s,s),e.restore();a()}})}default:return Promise.resolve()}}constructor(e){this.getPreferenceSettings=e}}var et=i(42243);class ei{get isRunning(){return this._running}request(e){if(!this._running){var t;this._running=!0,null===(t=this._worker)||void 0===t||t.postMessage(e)}}constructor(e){if(this._running=!1,this._worker=null,e.canUseDOM&&"undefined"!=typeof Worker){let{scriptURL:t,options:i,onResponse:r}=e,s=new Worker(t,i);s.onmessage=e=>{this._running=!1,r(e)},this._worker=s}}}class er{run(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,{_tasks:r,_taskMap:s,_previousTaskHolder:a}=this;return new Promise((o,n)=>{this._taskId+=1;let l={id:this._taskId,type:e,data:t,status:"pending",resolve:o,reject:n};r.enqueue(l),s.set(l.id,l);let c=a.get(i);void 0!==c&&"pending"===c.status&&(c.status="canceled",c.resolve(null),l.id=c.id),a.set(i,l),this._schedule()})}_schedule(){let e;let t=this._workers.find(e=>!e.isRunning);if(void 0===t)return;let{_tasks:i}=this;for(;i.size>0&&"pending"!==(e=i.dequeue()).status;);(null==e?void 0:e.status)==="pending"&&(e.status="running",t.request({id:e.id,type:e.type,data:e.data}))}constructor(e){var t;let i=Math.max(1,Math.min(100,e.workerInstanceCount));this._requestId=0,this._taskId=0,this._tasks=new et.T,this._taskMap=new Map,this._previousTaskHolder=new Map,this._tasks.init(),this._tasks.resize(null!==(t=e.MAX_TASK_NUMBER)&&void 0!==t?t:1e4),this._workers=Array(i).fill([]).map(()=>new ei({canUseDOM:e.canUseDOM,scriptURL:e.workerUrl,options:e.workerOptions,onResponse:e=>{let{id:t,data:i,error:r}=e.data,s=this._taskMap.get(t);switch((0,k.kG)(void 0!==s,()=>"[Webworker] Cannot find the running task with id (".concat(t,")")),s.status){case"running":null===i?s.reject("[Webworker] Cannot solve the request. ".concat(r)):s.resolve(i),s.status="done";break;case"pending":case"done":throw Error("[Webworker] Bad task status (".concat(s.status,"). id (").concat(t,")"))}this._schedule()}}))}}(m||(m={})).MOVE="move";let es=new er({canUseDOM:!0,workerUrl:"/asset/js/webworker/gomoku.js",workerInstanceCount:1,MAX_TASK_NUMBER:10});async function ea(e){let t=await es.run(m.MOVE,e);if(null===t)return[-1,-1];let{r:i,c:r}=t;return[i,r]}class eo{async move(e){let t=Date.now(),i=this._move(e),r=t+this.MINIMAL_THINKING_TIME-Date.now();return r>0&&await (0,k.gw)(r),i}constructor(e){var t;let i=Math.min(3e5,null!==(t=e.MINIMAL_THINKING_TIME)&&void 0!==t?t:0);this.MINIMAL_THINKING_TIME=i}}class en extends eo{async _move(e){let{MAX_ROW:t,MAX_COL:i,pieces:r,playerId:s}=e,[a,o]=await ea({MAX_ROW:t,MAX_COL:i,pieces:Array.from(r),playerId:s,MAX_ADJACENT:this.MAX_ADJACENT,MAX_DISTANCE_OF_NEIGHBOR:this.MAX_DISTANCE_OF_NEIGHBOR});return[a,o]}constructor(e){super(e),this.type=u.COMPUTER,this.MAX_ADJACENT=e.MAX_ADJACENT,this.MAX_DISTANCE_OF_NEIGHBOR=e.MAX_DISTANCE_OF_NEIGHBOR,this.scoreMap=e.scoreMap}}class el extends eo{_move(e){if(null!=e.clickedPos){let{r:t,c:i}=e.clickedPos;return[t,i]}return[-1,-1]}constructor(...e){super(...e),this.type=u.HUMAN}}var ec=i(15288);class ed extends eo{_move(e){let{MAX_ROW:t,MAX_COL:i}=e,r=Array.from(e.pieces);if(r.length<=0)return[t>>1,i>>1];for(let e of((0,ec.ZP)(r),(0,ec.ZP)(this.shufflableDirections),r))for(let[s,a]of this.shufflableDirections){let o=e.r+s,n=e.c+a;if(o>=0&&o<t&&n>=0&&n<i){if(r.some(e=>e.r===o&&e.c===n))continue;return[o,n]}}return[-1,-1]}constructor(e){super(e),this.type=u.STUPID_COMPUTER,this.shufflableDirections=W.bs.slice()}}let eh=e=>{switch(e.type){case u.HUMAN:return new el({MINIMAL_THINKING_TIME:0});case u.COMPUTER:return new en({MAX_ADJACENT:5,MAX_DISTANCE_OF_NEIGHBOR:2,MINIMAL_THINKING_TIME:300});case u.STUPID_COMPUTER:return new ed({MINIMAL_THINKING_TIME:300})}},ep=()=>{var e;let t=F(),i=(0,f.vc)(t.status$),r=(0,f.vc)(t.MAX_ROW$),s=(0,f.vc)(t.MAX_COL$),a=(0,f.vc)(t.pieces$),o=(0,f.vc)(t.players$),n=(0,f.vc)(t.mover$),l=v.useRef([]);(null===(e=l.current[n])||void 0===e?void 0:e.type)!==o[n].type&&(l.current[n]=eh(o[n]));let c=l.current[n],d=v.useRef(!1),p=(0,O.$0)(async e=>{if(!d.current&&void 0!==c&&i===U.X.RUNNING)try{d.current=!0;let[i,o]=await c.move({MAX_ROW:r,MAX_COL:s,pieces:a,playerId:n,clickedPos:e});(0,k.kG)(i>=0&&i<r&&o>=0&&o<=s,()=>"[Unexpected moving] currentPlayer(".concat(n,"}), moving: (").concat(i,", ").concat(o,")")),t.dispatch({type:h.MOVE,payload:{r:i,c:o}})}catch(e){console.error("Failed to move:",e)}finally{d.current=!1,await (0,k.gw)(50)}}),u=L(c.type);return v.useEffect(()=>{if(!u||i!==U.X.RUNNING)return;let e=setTimeout(()=>void p(),0);return()=>clearTimeout(e)},[n,u,i,p]),{move:p}},eu=e=>{let{overlay:t,className:i}=e,r=F(),s=(0,f.vc)(r.MAX_ROW$),a=(0,f.vc)(r.pieces$),o=(0,f.vc)(r.status$),n=(0,f.vc)(r.players$),{borderColor:l}=(0,f.vc)(r.preference$),c=v.useRef(null),d=(0,k.xv)(l),h=ep(),p=(0,O.$0)((e,t)=>{e>=0&&e<s&&t>=0&&t<s&&h.move({r:e,c:t})}),u=(0,O.$0)(e=>n[e].preference),m=(0,O.$0)(async()=>{await (null==y?void 0:y.draw(a))}),[y,C]=v.useState(null);return v.useEffect(()=>{let e=new ee(u),t=new Q({canvas:c.current,lines:15,pieces:B.aV.of(),pieceDrawer:e,listeners:{onClick:p}});return C(t),()=>t.destroy()},[p,u]),v.useEffect(()=>{null!=y&&(y.reset({canvas:c.current,GOMOKU_SIZE:s,styles:{gridLineColor:d}}),m())},[y,s,d,m]),v.useEffect(()=>{null==y||y.draw(a)},[y,a]),(0,g.BX)("div",{className:(0,b.cx)(eg.container,i),children:[(0,g.tZ)("div",{className:(0,b.cx)(eg.overlay,o===U.X.PENDING&&eg.overlayPending,o===U.X.RUNNING&&eg.overlayRunning,o===U.X.PAUSED&&eg.overlayPaused,o===U.X.END&&eg.overlayEnd),children:t},"overlay"),(0,g.tZ)("canvas",{ref:c})]})},em={finished:(0,b.F4)({"0%":{transform:"translate(0, -100px)"},"80%":{transform:"translate(0, 20px)"},"90%":{transform:"translate(0, -10px)"},"95%":{transform:"translate(0, 2px)"},"100%":{transform:"translate(0, 0)"}})},eg={container:(0,b.iv)({position:"relative",boxSizing:"content-box",display:"inline-block",width:"100%",height:"100%",padding:0,border:0,margin:0,fontFamily:"Consolas, 'Source Code Pro', 'Roboto Mono', monospace, sans-serif"}),overlay:(0,b.iv)({zIndex:2,position:"absolute",top:0,left:0,right:0,bottom:0,display:"none",width:"100%",height:"100%",overflow:"hidden",background:d.colorBgOverlay}),overlayPending:(0,b.iv)({display:"block",backdropFilter:"blur(1px)"}),overlayRunning:(0,b.iv)({display:"none"}),overlayPaused:(0,b.iv)({display:"block",backdropFilter:"blur(4px)"}),overlayEnd:(0,b.iv)({display:"block",backdropFilter:"blur(4px)",color:d.colorOverlayEnd,animation:"1s 0s ".concat(em.finished," ease-in-out")})};var ev=i(64866),ef=i(39552),ey=i(69867),eb=i(90680);class ek extends v.Component{shouldComponentUpdate(e){let t=this.props;return t.status!==e.status||t.winner!==e.winner||t.attemptTick!==e.attemptTick||t.players!==e.players}render(){let{start:e,resume:t,restart:i}=this,{status:r,players:s}=this.props,a=s[this.props.winner];switch(r){case U.X.PENDING:return(0,g.tZ)("div",{className:eC.overlay,children:(0,g.tZ)(w.Z,{className:eC.button,variant:"contained",color:"inherit",startIcon:(0,g.tZ)(ey.default,{}),onClick:e,children:"Start"})});case U.X.PAUSED:return(0,g.tZ)("div",{className:eC.overlay,children:(0,g.tZ)(w.Z,{className:eC.button,variant:"contained",color:"inherit",startIcon:(0,g.tZ)(ef.default,{}),onClick:t,children:"Resume"})});case U.X.END:return(0,g.tZ)("div",{className:eC.overlay,children:(0,g.BX)("div",{className:eC.finishedBanner,children:[void 0!==a?(0,g.BX)("div",{className:eC.blessing,children:[(0,g.tZ)("div",{className:eC.winner,children:(0,g.tZ)("span",{className:eC.winnerAvatar,style:{background:(0,k.l9)(a.preference.pieceFillStyle),backgroundSize:"cover"}},"avatar")}),"win\uD83C\uDF89"]}):(0,g.tZ)("p",{children:"Draw!"}),(0,g.tZ)(w.Z,{className:eC.button,variant:"contained",color:"inherit",startIcon:(0,g.tZ)(eb.default,{}),onClick:i,children:"New"})]})});default:return(0,g.tZ)(v.Fragment,{})}}componentDidUpdate(e){let t=this.props.attemptTick>0,i=this.props.status;e.status!==i&&i===U.X.END&&t&&void 0!==this.props.players[this.props.winner]&&this.props.throwConfetti()}constructor(...e){super(...e),this.start=()=>{let{dispatchGomokuAction:e}=this.props;e({type:h.START})},this.resume=()=>{let{dispatchGomokuAction:e}=this.props;e({type:h.RESUME})},this.restart=()=>{let{dispatchGomokuAction:e}=this.props;e({type:h.RESTART})}}}ek.displayName="$GameOverlay",ek.propTypes={status:x().number.isRequired,winner:x().number.isRequired,attemptTick:x().number.isRequired,players:x().array.isRequired,dispatchGomokuAction:x().func.isRequired,throwConfetti:x().func.isRequired};let eC={overlay:(0,b.iv)({position:"relative",display:"flex",alignItems:"center",justifyContent:"center",height:"100%",width:"100%",userSelect:"none"}),confettiCanvas:(0,b.iv)({top:0,bottom:0,left:0,right:0,width:"100%",height:"100%"}),button:(0,b.iv)({color:d.colorButton,"&&, &&:hover":{boxShadow:"4px 4px 16px 0px hsl(0deg 0% 0% / 0.75)"}}),finishedBanner:(0,b.iv)({position:"relative",display:"flex",flexDirection:"column",justifyContent:"center",padding:0,margin:0,fontSize:32}),blessing:(0,b.iv)({display:"flex",alignItems:"center",marginBottom:"1rem"}),winner:(0,b.iv)({display:"flex",flexDirection:"column",alignItems:"center",marginRight:16}),winnerAvatar:(0,b.iv)({display:"inline-block",width:32,height:32,borderRadius:"50%"})},eN=()=>{let e=F(),t=(0,f.vc)(e.status$),i=(0,f.vc)(e.winner$),r=(0,f.vc)(e.attemptTick$),s=(0,f.vc)(e.players$),a=(0,ev.D)();return(0,g.tZ)(ek,{status:t,winner:i,attemptTick:r,players:s,dispatchGomokuAction:e.dispatch,throwConfetti:a})};var eS=i(91175);class eR extends v.Component{shouldComponentUpdate(e){let t=this.props;return t.colon!==e.colon||!(0,eS.X)(t.data,e.data)||!(0,eS.X)(t.items,e.items)||!(0,eS.X)(t.itemsOrder,e.itemsOrder)||!(0,eS.X)(t.classes,e.classes)}render(){var e,t,i;let{onChange:r}=this,{data:s,items:a,itemsOrder:o,colon:n}=this.props,l={formItem:(0,b.cx)(ew.formItem,null===(e=this.props.classes)||void 0===e?void 0:e.formItem),label:(0,b.cx)(ew.label,null===(t=this.props.classes)||void 0===t?void 0:t.label),content:(0,b.cx)(ew.content,null===(i=this.props.classes)||void 0===i?void 0:i.content)},c=o.map(e=>{let t=a[e],{FormItemRenderer:i}=t;return(0,g.BX)("div",{className:l.formItem,children:[(0,g.BX)("div",{className:l.label,children:[t.label,n]}),(0,g.tZ)("div",{className:l.content,children:(0,g.tZ)(i,{value:s[e],onChange:t=>r(e,t)})})]},e)});return(0,g.tZ)(v.Fragment,{children:c})}constructor(...e){super(...e),this.onChange=(e,t)=>{this.props.onChange({[e]:t})}}}eR.displayName="Form",eR.propTypes={data:x().object.isRequired,items:x().object.isRequired,itemsOrder:x().array.isRequired,classes:x().object,colon:x().node,onChange:x().func.isRequired};let ew={formItem:(0,b.iv)({position:"relative",display:"flex",alignItems:"flex-start"}),label:(0,b.iv)({flex:"0 1 auto",display:"inline-flex",justifyContent:"flex-end",alignItems:"flex-start",marginRight:8,userSelect:"none",height:"100%"}),content:(0,b.iv)({flex:"1 1 auto",display:"inline-flex",justifyContent:"flex-start",alignItems:"flex-start",height:"100%"})};var eP=i(5734),ex=i(99831),eI=i(95196);class eE extends v.Component{static getDerivedStateFromProps(e,t){let i=(0,k.ei)(e.data,e.keys);return(0,eS.X)(i,t.value)?null:{value:i}}shouldComponentUpdate(e,t){let i=this.props;return this.state.value!==t.value||i.FormItemGroupRenderer!==e.FormItemGroupRenderer||!(0,eS.X)(i.keys,e.keys)}render(){let{onChange:e}=this,{FormItemGroupRenderer:t}=this.props,{value:i}=this.state;return(0,g.tZ)(t,{data:i,onChange:e})}constructor(e){super(e),this.onChange=e=>{this.props.onChange(e)},this.state={value:(0,k.ei)(e.data,e.keys)}}}eE.displayName="FormItemGroup",eE.propTypes={data:x().object.isRequired,keys:x().array.isRequired,FormItemGroupRenderer:x().any.isRequired,onChange:x().func.isRequired};class eD extends v.Component{shouldComponentUpdate(e,t){let i=this.props,r=this.state;return r.isNoChangeWithFactoryData!==t.isNoChangeWithFactoryData||r.isNoChangeWithInitialData!==t.isNoChangeWithInitialData||!(0,eS.X)(r.data,t.data)||i.container!==e.container||i.isResetAvailable!==e.isResetAvailable||i.formItemGroups!==e.formItemGroups||!(0,eS.X)(i.classes,e.classes)||!(0,eS.X)(i.factoryData,e.factoryData)}render(){var e;let{onConfirm:t,onDiscard:i,onChange:r,onReset:s,onClose:a}=this,{container:o,formItemGroups:n,isResetAvailable:l=!0}=this.props,{data:c,isNoChangeWithFactoryData:d,isNoChangeWithInitialData:h}=this.state,p={dialog:(0,b.cx)(eT.dialog,null===(e=this.props.classes)||void 0===e?void 0:e.dialog)},u=n.map((e,t)=>(0,g.tZ)(eE,{data:c,keys:e.keys,FormItemGroupRenderer:e.FormItemGroupRenderer,onChange:r},t));return(0,g.BX)(v.Fragment,{children:[(0,g.BX)(eP.Z,{"aria-labelledby":"edit-player",container:o,open:!0,onClose:a,children:[(0,g.tZ)(ex.Z,{className:p.dialog,children:u}),(0,g.BX)(eI.Z,{children:[null!=this.props.factoryData&&(0,g.tZ)(w.Z,{color:"inherit",disabled:!l||d,onClick:s,children:"Reset"}),(0,g.tZ)(w.Z,{color:"inherit",onClick:i,children:"Discard"}),(0,g.tZ)(w.Z,{color:"primary",disabled:h,onClick:t,children:"Save"})]})]}),(0,g.tZ)(eZ,{beforeUnload:i})]})}updateData(e){var t;let i=this.state.initialData,r=null!==(t=this.props.factoryData)&&void 0!==t?t:i,s=(0,eS.X)(i,e),a=(0,eS.X)(r,e);this.setState({data:e,isNoChangeWithFactoryData:a,isNoChangeWithInitialData:s})}constructor(e){var t;super(e),this.onConfirm=()=>{let{data:e}=this.state;this.props.onSave(e)},this.onDiscard=()=>{let{initialData:e}=this.state;this.props.onDiscard(e)},this.onChange=e=>{var t,i;let r={...this.state.data,...e};this.updateData(r),null===(t=(i=this.props).onRealTimeChange)||void 0===t||t.call(i,r)},this.onReset=()=>{var e,t,i,r,s;let a={...null!==(s=this.props.factoryData)&&void 0!==s?s:this.state.initialData};this.updateData(a),null===(e=(t=this.props).onReset)||void 0===e||e.call(t),null===(i=(r=this.props).onRealTimeChange)||void 0===i||i.call(r,a)},this.onClose=()=>{let{isNoChangeWithInitialData:e}=this.state;e&&this.props.onDiscard(this.state.initialData)},this.state={initialData:e.initialData,data:e.initialData,isNoChangeWithFactoryData:(0,eS.X)(null!==(t=e.factoryData)&&void 0!==t?t:e.initialData,e.initialData),isNoChangeWithInitialData:!0}}}eD.displayName="FormDialog",eD.propTypes={initialData:x().object.isRequired,factoryData:x().object,isResetAvailable:x().bool,formItemGroups:x().array.isRequired,container:x().any,classes:x().object,onSave:x().func.isRequired,onDiscard:x().func.isRequired,onReset:x().func,onRealTimeChange:x().func};let eT={dialog:(0,b.iv)({minWidth:240,minHeight:320})},eZ=e=>((0,O.TK)(()=>void e.beforeUnload(),[]),(0,g.tZ)(v.Fragment,{}));class eM extends v.Component{shouldComponentUpdate(e,t){let i=this.props;return this.state.isPickerVisible!==t.isPickerVisible||i.value!==e.value||i.disabled!==e.disabled||i.required!==e.required||i.pickerClassName!==e.pickerClassName}render(){let{onContainerClick:e,onToggleVisible:t,onVisibleChange:i,onBackgroundChange:r}=this,{value:s,disabled:a=!1,pickerClassName:o}=this.props,{isPickerVisible:n}=this.state,l=e$(s,a);return(0,g.BX)("div",{className:l.container,onClick:e,children:[(0,g.tZ)("div",{className:l.swatch,onClick:t,children:(0,g.tZ)("div",{className:l.colorSquare})}),(0,g.tZ)(T,{className:(0,b.cx)(l.picker,o),visible:n,disabled:a,background:s,onVisibleChange:i,onBackgroundChange:r})]})}componentDidMount(){window.addEventListener("click",this.closePicker)}componentWillUnmount(){window.removeEventListener("click",this.closePicker)}constructor(e){super(e),this.onToggleVisible=()=>{this.props.disabled||this.setState(e=>({isPickerVisible:!e.isPickerVisible}))},this.onVisibleChange=e=>{this.setState({isPickerVisible:e})},this.onBackgroundChange=e=>{this.props.disabled||this.props.onChange(e)},this.onContainerClick=e=>{e.stopPropagation()},this.closePicker=()=>{this.setState({isPickerVisible:!1})},this.state={isPickerVisible:!1}}}eM.displayName="FormItemBackground",eM.propTypes={value:x().object.isRequired,disabled:x().bool,required:x().bool,pickerClassName:x().string,onChange:x().func.isRequired};let e$=(e,t)=>({container:(0,b.iv)({display:"flex",alignItems:"center",caretColor:"transparent"}),swatch:(0,b.iv)({display:"inline-block",padding:3,border:"1px solid rgba(0,0,0,.2)",borderRadius:"1px",background:"var(--colorBgSwatch, #fff)",cursor:t?"default":"pointer"}),colorSquare:(0,b.iv)("image"===e.prefer?{width:32,height:32,borderRadius:2,background:(0,k.l9)(e),backgroundSize:"cover"}:{width:32,height:12,borderRadius:2,background:(0,k.l9)(e),backgroundSize:"cover"}),picker:(0,b.iv)({"&&":{transform:"translate(calc(-50% - 16px), -20%)",color:"var(--colorPicker, #333)",background:"var(--colorBgPicker, #fff)"}})});class e_ extends v.Component{shouldComponentUpdate(e,t){let i=this.props;return this.state.isPickerVisible!==t.isPickerVisible||i.value!==e.value||i.disabled!==e.disabled||i.required!==e.required}render(){let{onContainerClick:e,onToggleVisible:t,onVisibleChange:i,onColorChange:r}=this,{value:s,disabled:a}=this.props,{isPickerVisible:o}=this.state,n=eA(s,a);return(0,g.BX)("div",{className:n.container,onClick:e,children:[(0,g.tZ)("div",{className:n.swatch,onClick:t,children:(0,g.tZ)("div",{className:n.colorSquare})}),(0,g.tZ)(Z,{className:n.picker,visible:o,color:s,onVisibleChange:i,onColorChange:r})]})}componentDidMount(){window.addEventListener("click",this.closePicker)}componentWillUnmount(){window.removeEventListener("click",this.closePicker)}constructor(e){super(e),this.onToggleVisible=()=>{this.props.disabled||this.setState(e=>({isPickerVisible:!e.isPickerVisible}))},this.onVisibleChange=e=>{this.setState({isPickerVisible:e})},this.onColorChange=e=>{this.props.disabled||this.props.onChange(e)},this.onContainerClick=e=>{e.stopPropagation()},this.closePicker=()=>{this.setState({isPickerVisible:!1})},this.state={isPickerVisible:!1}}}e_.displayName="FormItemColor",e_.propTypes={value:x().object.isRequired,disabled:x().bool,required:x().bool,onChange:x().func.isRequired};let eA=(e,t)=>({container:(0,b.iv)({display:"flex",alignItems:"center",caretColor:"transparent"}),swatch:(0,b.iv)({display:"inline-block",padding:2,border:"1px solid rgba(0,0,0,.2)",borderRadius:"1px",background:"var(--colorBgSwatch, #fff)",cursor:t?"default":"pointer"}),colorSquare:(0,b.iv)({width:32,height:12,borderRadius:2,backgroundColor:(0,k.xv)(e)}),picker:(0,b.iv)({"&&":{transform:"translate(calc(-50% - 16px), -20%)",color:"var(--colorPicker, #333)",background:"var(--colorBgPicker, #fff)"}})});var eX=i(78545),eO=i(52472);class eU extends v.Component{shouldComponentUpdate(e){let t=this.props;return t.value!==e.value||t.disabled!==e.disabled||t.required!==e.required||!(0,eS.X)(t.choices,e.choices)}render(){let{onChange:e}=this,{value:t,choices:i,disabled:r,required:s}=this.props,a=Array.isArray(i)?i.map(e=>(0,g.tZ)(eX.Z,{value:e,children:e},e)):Object.keys(i).map(e=>(0,g.tZ)(eX.Z,{value:e,children:i[e]},e));return(0,g.tZ)(eO.Z,{variant:"standard",required:s,disabled:r,value:t,onChange:e,children:a})}constructor(...e){super(...e),this.onChange=e=>{let{normalize:t,onChange:i}=this.props;i(t?t(e.target.value):e.target.value)}}}eU.displayName="FormItemEnum",eU.propTypes={value:x().any.isRequired,choices:x().any.isRequired,disabled:x().bool,required:x().bool,onChange:x().func.isRequired,normalize:x().func};var eB=i(82384);class eq extends v.Component{shouldComponentUpdate(e,t){let i=this.props;return this.state.value!==t.value||i.value!==e.value||i.disabled!==e.disabled||i.required!==e.required}render(){let{onChange:e,onBlur:t}=this,{disabled:i,required:r}=this.props,{value:s}=this.state;return(0,g.tZ)(eB.Z,{variant:"standard",disabled:i,required:r,value:s,onChange:e,onBlur:t})}componentDidUpdate(e){let t=this.props,i=this.state;t.value!==e.value&&i.value!==t.value&&this.setState({value:t.value})}constructor(e){super(e),this.onChange=e=>{this.setState({value:e.target.value})},this.onBlur=()=>{this.props.onChange(this.state.value)},this.state={value:e.value}}}eq.displayName="FormItemString",eq.propTypes={value:x().string.isRequired,disabled:x().bool,required:x().bool,onChange:x().func.isRequired};var eG=i(11518),eF=i(49565);let eW=e=>{let t=F(),i=(0,f.vc)(t.status$)===U.X.END;return(0,g.tZ)(eM,{...e,disabled:i})},eV=Object.fromEntries([5,7,9,11,13,15,17,19,21,23,25].map(e=>[e,"".concat(e,"x").concat(e)])),eL=e=>Number(e),ez=["size","background","border"],ej={size:{label:"Size",FormItemRenderer:e=>{let t=F(),i=(0,f.vc)(t.status$)!==U.X.PENDING;return(0,g.tZ)(eU,{...e,disabled:i,choices:eV,normalize:eL})}},background:{label:"Background",FormItemRenderer:e=>(0,g.tZ)(eW,{...e,pickerClassName:eJ.boardImagePicker})},border:{label:"Board",FormItemRenderer:e=>{let t=F(),i=(0,f.vc)(t.status$)===U.X.END;return(0,g.tZ)(e_,{...e,disabled:i})}}};class eH extends v.Component{shouldComponentUpdate(e){let t=this.props;return!(0,eS.X)(t.data,e.data)}render(){let{onChange:e}=this,{data:t}=this.props;return(0,g.tZ)(eR,{data:t,items:ej,itemsOrder:ez,classes:eK,onChange:e})}constructor(...e){super(...e),this.onChange=e=>{this.props.onChange(e)}}}eH.displayName="GameBaseSettingsRenderer",eH.propTypes={data:x().object.isRequired,onChange:x().func.isRequired};let eY={keys:ez,FormItemGroupRenderer:eH},eK={formItem:(0,b.iv)({margin:"1rem 1rem",alignItems:"center"}),label:(0,b.iv)({minWidth:"6rem"})},eJ={boardImagePicker:(0,b.iv)({"&&":{}})},eQ=e=>{let t=F(),i=(0,f.vc)(t.status$),r=(0,f.vc)(t.MAX_ROW$),{boardBackground:s,borderColor:a}=(0,f.vc)(t.preference$),[o,n]=v.useState(!1),l=v.useMemo(()=>({size:H.MAX_ROW,background:H.preference.boardBackground,border:H.preference.borderColor}),[]),c=v.useMemo(()=>({size:r,background:s,border:a}),[r,s,a]),d=v.useMemo(()=>[eY],[]),p=i===U.X.END,u={onOpenDialog:(0,O.$0)(()=>n(!0)),onRealTimeChange:(0,O.$0)(e=>{r!==e.size&&t.dispatch({type:h.RESET,payload:{MAX_ROW:e.size,MAX_COL:e.size}}),(s!==e.background||a!==e.border)&&t.dispatch({type:h.MODIFY_PREFERENCE,payload:{boardBackground:e.background,borderColor:e.border}})}),onSave:e=>{u.onRealTimeChange(e),n(!1)},onDiscard:(0,O.$0)(e=>{u.onRealTimeChange(e),n(!1)})},{WakeBtn:m=e0}=e;return(0,g.BX)("div",{className:(0,b.cx)(e1.container,e.className),children:[(0,g.tZ)(m,{onWakeUp:u.onOpenDialog}),o&&(0,g.tZ)(eD,{container:e.containerRef.current,initialData:c,factoryData:l,isResetAvailable:!p,formItemGroups:d,classes:e2,onSave:u.onSave,onDiscard:u.onDiscard,onRealTimeChange:u.onRealTimeChange})]})},e0=e=>(0,g.tZ)(eF.Z,{size:"small",className:e1.wakeBtn,onClick:e.onWakeUp,children:(0,g.tZ)(eG.Z,{})}),e1={container:(0,b.iv)({}),wakeBtn:(0,b.iv)({"> svg":{width:18,height:18}})},e2={dialog:(0,b.iv)({minWidth:240,minHeight:320})};var e3=i(62578),e5=i(80350);class e6 extends v.Component{shouldComponentUpdate(e,t){let i=this.props;return this.state.isRestartDialogVisible!==t.isRestartDialogVisible||i.containerRef!==e.containerRef||i.status!==e.status||i.mover!==e.mover||i.pieces!==e.pieces}render(){let{flip:e,retract:t,restart:i,start:r,closeRestartDialog:s}=this,{containerRef:a,status:o,mover:n,pieces:l}=this.props,{isRestartDialogVisible:c}=this.state,d=o!==U.X.PENDING,h=(o===U.X.RUNNING||o===U.X.END)&&l.some(e=>e.p===n),p=o===U.X.PENDING;return(0,g.BX)("div",{className:e4.toolbar,children:[(0,g.BX)("div",{className:(0,b.cx)(e4.item,e4.buttons),children:[(0,g.tZ)(w.Z,{variant:"contained",color:"inherit",size:"small",startIcon:(0,g.tZ)(eb.default,{}),disabled:!d,onClick:r,children:(0,g.tZ)("span",{className:e4.buttonText,children:"New"})}),(0,g.tZ)(w.Z,{variant:"contained",color:"inherit",size:"small",startIcon:(0,g.tZ)(e3.Z,{}),disabled:!h,onClick:t,children:(0,g.tZ)("span",{className:e4.buttonText,children:"Retract"})}),(0,g.tZ)(w.Z,{variant:"contained",color:"inherit",size:"small",startIcon:(0,g.tZ)(e5.Z,{}),disabled:!p,onClick:e,children:(0,g.tZ)("span",{className:e4.buttonText,children:"Flip"})}),(0,g.tZ)(eQ,{containerRef:a})]}),(0,g.BX)(eP.Z,{container:a.current,open:c,onClose:s,"aria-labelledby":"confirm-to-restart",children:[(0,g.tZ)(ex.Z,{children:"Are you sure you want to start a new game?"}),(0,g.BX)(eI.Z,{className:e4.dialogActions,children:[(0,g.tZ)(w.Z,{color:"inherit",onClick:s,children:"Cancel"}),(0,g.tZ)(w.Z,{color:"primary",onClick:i,children:"Confirm"})]})]})]})}constructor(e){super(e),this.flip=()=>{let{dispatchGomokuAction:e}=this.props;e({type:h.FLIP_PLAYER})},this.retract=()=>{let{dispatchGomokuAction:e}=this.props;e({type:h.RETRACT})},this.restart=()=>{let{dispatchGomokuAction:e}=this.props;e({type:h.RESTART}),this.setState({isRestartDialogVisible:!1})},this.start=()=>{let{status:e,dispatchGomokuAction:t}=this.props;e===U.X.PENDING||e===U.X.END?t({type:h.RESTART}):this.setState({isRestartDialogVisible:!0})},this.closeRestartDialog=()=>{this.setState({isRestartDialogVisible:!1})},this.state={isRestartDialogVisible:!1}}}e6.displayName="$GameToolbar",e6.propTypes={containerRef:x().object.isRequired,status:x().number.isRequired,mover:x().number.isRequired,pieces:x().any.isRequired,dispatchGomokuAction:x().func.isRequired};let e4={toolbar:(0,b.iv)({display:"block",maxWidth:"min(90vw, 400px)",margin:"auto"}),item:(0,b.iv)({display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"flex-start",margin:"1rem 0"}),buttons:(0,b.iv)({justifyContent:"space-around",color:d.colorButton,"> button":{display:"flex",justifyContent:"spaceBetween",alignItems:"center",margin:"0 4px"}}),buttonText:(0,b.iv)({lineHeight:1.1}),dialogActions:(0,b.iv)({color:d.colorButton})},e8=e=>{let t=F(),i=(0,f.vc)(t.status$),r=(0,f.vc)(t.mover$),s=(0,f.vc)(t.pieces$);return(0,g.tZ)(e6,{status:i,mover:r,pieces:s,containerRef:e.containerRef,dispatchGomokuAction:t.dispatch})},e9=e=>{let t=F(),i=(0,f.vc)(t.status$)===U.X.END;return(0,g.tZ)(eM,{...e,disabled:i})},e7=[u.HUMAN,u.COMPUTER,u.STUPID_COMPUTER],te=["name","type","pieceFill"],tt={name:{label:"Name",FormItemRenderer:e=>{let t=F(),i=(0,f.vc)(t.status$)===U.X.END;return(0,g.tZ)(eq,{...e,disabled:i})}},type:{label:"Type",FormItemRenderer:e=>{let t=F(),i=(0,f.vc)(t.status$)!==U.X.PENDING;return(0,g.tZ)(eU,{...e,disabled:i,choices:e7})}},pieceFill:{label:"Avatar",FormItemRenderer:e=>(0,g.tZ)(e9,{...e,pickerClassName:ta.boardImagePicker})}};class ti extends v.Component{shouldComponentUpdate(e){let t=this.props;return!(0,eS.X)(t.data,e.data)}render(){let{onChange:e}=this,{data:t}=this.props;return(0,g.tZ)(eR,{data:t,items:tt,itemsOrder:te,classes:ts,onChange:e})}constructor(...e){super(...e),this.onChange=e=>{this.props.onChange(e)}}}ti.displayName="PlayerSettingsRenderer",ti.propTypes={data:x().object.isRequired,onChange:x().func.isRequired};let tr={keys:te,FormItemGroupRenderer:ti},ts={formItem:(0,b.iv)({margin:"1rem 1rem",alignItems:"center"}),label:(0,b.iv)({minWidth:"6rem"})},ta={boardImagePicker:(0,b.iv)({"&&":{transform:"translate(calc(-50% + 32px), -40%)"}})},to=e=>{let{playerId:t}=e,i=F(),r=(0,f.vc)(i.status$),s=(0,f.vc)(i.players$)[t],a=v.useMemo(()=>{let e=H.players[t];return{name:e.name,type:e.type,pieceFill:e.preference.pieceFillStyle,pieceStroke:e.preference.pieceStrokeStyle}},[t]),o=v.useMemo(()=>({name:s.name,type:s.type,pieceFill:s.preference.pieceFillStyle,pieceStroke:s.preference.pieceStrokeStyle}),[s]),n=v.useMemo(()=>[tr],[]),l=r===U.X.END,c={onRealTimeChange:(0,O.$0)(e=>{i.dispatch({type:h.MODIFY_PLAYER,payload:{id:t,type:e.type,name:e.name,preference:(0,k.S4)({pieceFillStyle:e.pieceFill,pieceStrokeStyle:e.pieceStroke})}})}),onSave:t=>{c.onRealTimeChange(t),e.onClose()},onDiscard:(0,O.$0)(t=>{c.onRealTimeChange(t),e.onClose()})};return(0,g.tZ)(v.Fragment,{children:e.visible&&(0,g.tZ)(eD,{container:e.containerRef.current,initialData:o,factoryData:a,isResetAvailable:!l,formItemGroups:n,classes:tn,onSave:c.onSave,onDiscard:c.onDiscard,onRealTimeChange:c.onRealTimeChange})})},tn={dialog:(0,b.iv)({minWidth:240,minHeight:320})};class tl extends v.Component{shouldComponentUpdate(e,t){let i=this.props;return this.state.editingPlayerId!==t.editingPlayerId||i.containerRef!==e.containerRef||i.status!==e.status||i.mover!==e.mover||i.players!==e.players}render(){let{onCancel:e,onEditPlayer0:t,onEditPlayer1:i,onPlayer0AvatarChange:r,onPlayer1AvatarChange:s}=this,{containerRef:a,status:o,mover:n,players:l}=this.props,{editingPlayerId:c}=this.state,[d,h]=l,p=o===U.X.RUNNING,u=o===U.X.PENDING;return(0,g.BX)("div",{className:tc.container,children:[(0,g.tZ)(_,{position:"left",className:tc.player0,name:d.name,type:d.type,avatar:d.preference.pieceFillStyle,disabled:!u,running:p,thinking:0===n,onEdit:t,onAvatarChange:r},"player0"),(0,g.tZ)("span",{className:tc.versus,children:"VS"}),(0,g.tZ)(_,{position:"right",className:tc.player1,name:h.name,type:h.type,avatar:h.preference.pieceFillStyle,disabled:!u,running:p,thinking:1===n,onEdit:i,onAvatarChange:s},"player1"),null!=c&&(0,g.tZ)(to,{containerRef:a,visible:!0,playerId:c,onClose:e})]})}constructor(e){super(e),this.onCancel=()=>{this.setState({editingPlayerId:null})},this.onEditPlayer0=()=>{this.setState({editingPlayerId:0})},this.onEditPlayer1=()=>{this.setState({editingPlayerId:1})},this.onPlayer0AvatarChange=e=>{let{dispatchGomokuAction:t}=this.props;t({type:h.MODIFY_PLAYER,payload:{id:0,preference:{pieceFillStyle:e}}})},this.onPlayer1AvatarChange=e=>{let{dispatchGomokuAction:t}=this.props;t({type:h.MODIFY_PLAYER,payload:{id:1,preference:{pieceFillStyle:e}}})},this.state={editingPlayerId:null}}}tl.displayName="$DuelPlayers",tl.propTypes={containerRef:x().object.isRequired,status:x().number.isRequired,mover:x().number.isRequired,players:x().array.isRequired,dispatchGomokuAction:x().func.isRequired};let tc={container:(0,b.iv)({display:"flex",alignItems:"center",maxWidth:"min(90vw, 400px)",height:"3rem",width:"100%",margin:"auto"}),player0:(0,b.iv)({flex:"1 1 0",display:"flex"}),player1:(0,b.iv)({flex:"1 1 0",display:"flex"}),versus:(0,b.iv)({flex:"0 0 auto",margin:"0 36px",color:d.colorVersus})},td=e=>{let t=F(),i=(0,f.vc)(t.status$),r=(0,f.vc)(t.mover$),s=(0,f.vc)(t.players$);return(0,g.tZ)(tl,{containerRef:e.containerRef,status:i,mover:r,players:s,dispatchGomokuAction:t.dispatch})},th=()=>{let e=F(),t=v.useRef(null),i=tp();return(0,O.TK)(()=>e.dispatch({type:h.PAUSE}),[e]),(0,g.BX)("div",{ref:t,className:i.container,children:[(0,g.BX)("div",{className:i.header,children:[(0,g.tZ)(td,{containerRef:t}),(0,g.tZ)(e8,{containerRef:t})]}),(0,g.tZ)("div",{className:i.main,children:(0,g.tZ)(eu,{overlay:(0,g.tZ)(eN,{})})})]})},tp=()=>{let e=F(),{boardBackground:t}=(0,f.vc)(e.preference$);return{container:(0,b.iv)({boxSizing:"border-box",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:"100%"}),header:(0,b.iv)({boxSizing:"border-box",display:"flex",flexDirection:"column",justifyContent:"center",width:"100%",padding:"2vmin"}),main:(0,b.iv)({boxSizing:"border-box",height:"96vmin",width:"96vmin",background:(0,k.l9)(t),backgroundSize:"cover","@media (min-width: 1367px)":{width:"60vmin",height:"60vmin"}})}},tu=e=>{let{theme:t,children:i}=e,r=F(),s=(0,f.vc)(r.status$),a=(0,b.cx)(tm.common,t===k.Q2.light&&tm.light,t===k.Q2.darken&&tm.darken,s===U.X.PENDING&&tm.statusPending,s===U.X.PAUSED&&tm.statusPaused,s===U.X.END&&tm.statusEnd);return(0,g.tZ)("div",{className:a,children:i})},tm={common:(0,b.iv)({display:"block",transform:"scale(1)",caretColor:"transparent",background:"transparent"}),light:(0,b.iv)({"--colorBgOverlay":"linear-gradient(45deg, hsl(30, 20%, 90%, 0.2), hsl(210, 20%, 100%, 0.3))","--colorBgPicker":"hsla(0deg, 0%, 100%, 1)","--colorBgSwatch":"hsla(0deg, 0%, 100%, 1)","--colorBorderPicker":"hsl(0deg, 0%, 90%, 1)","--colorButton":"hsla(0deg, 0%, 20%, 1)","--colorOverlayEnd":"#ff00ff","--colorPicker":"hsla(0deg, 0%, 20%, 1)","--colorPlayerName":"hsla(30deg, 60%, 50%, 1)","--colorPlayerType":"hsla(0deg, 0%, 10%, 1)","--colorThinkingIcon":"hsla(0deg, 0%, 10%, 1)","--colorVersus":"hsla(0deg, 0%, 10%, 1)","--colorWinnerName":"hsla(30deg, 80%, 50%, 1)"}),darken:(0,b.iv)({"--colorBgOverlay":"linear-gradient(45deg, hsl(30, 20%, 90%, 0.2), hsl(210, 20%, 100%, 0.3))","--colorBgSwatch":"hsla(0deg, 0%, 20%, 1)","--colorBgPicker":"hsla(0deg, 0%, 20%, 1)","--colorBorderPicker":"hsl(0deg, 0%, 80%, 1)","--colorButton":"hsla(0deg, 0%, 80%, 1)","--colorOverlayEnd":"#ff00ff","--colorPicker":"hsla(0deg, 0%, 80%, 1)","--colorPlayerName":"hsla(30deg, 60%, 50%, 1)","--colorPlayerType":"hsla(0deg, 0%, 100%, 0.6)","--colorThinkingIcon":"hsla(0deg, 0%, 100%, 0.6)","--colorVersus":"hsla(0deg, 0%, 100%, 0.6)","--colorWinnerName":"hsla(30deg, 80%, 50%, 1)"}),statusPending:(0,b.iv)({"&&":{}}),statusPaused:(0,b.iv)({"&&":{}}),statusEnd:(0,b.iv)({"&&":{}})};var tg=i(40308);let tv=(0,k.Um)({displayName:"PersistentGomokuContextProvider",version:q,disposeWhenUnmounted:!0,Provider:G.Provider,Persistent:e=>{let{viewmodel:t,storage:i,storageKey:r}=e,s=(0,y.xo)(),a=(0,f.sD)(t,["MAX_ROW$","MAX_COL$","winner$","instructions$","gameTick$","players$","preference$"]),o=v.useMemo(()=>(0,tg.P2)(()=>{let e={MAX_ROW:t.MAX_ROW$.getSnapshot(),MAX_COL:t.MAX_COL$.getSnapshot(),winner:t.winner$.getSnapshot(),instructions:Array.from(t.instructions$.getSnapshot()),gameTick:t.gameTick$.getSnapshot(),players:Array.from(t.players$.getSnapshot()),preference:t.preference$.getSnapshot()};return s.reporter$.getSnapshot().debug("saving {}. data:",r,e),i.save({version:q,data:e})},200),[s,t,i,r]);return v.useEffect(()=>void o(),[o,a]),(0,O.i7)(()=>o.flushSync(),!1),(0,g.tZ)(v.Fragment,{})},SideEffect:()=>(0,g.tZ)(v.Fragment,{}),ViewModel:Y,initContextState:function(e){var t,i,r,s,a,o,n,l,c,d,h,u,m;let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:H,{MAX_ROW:v=g.MAX_ROW,MAX_COL:f=g.MAX_COL,instructions:y=g.instructions.slice(),gameTick:b=g.gameTick}={...e},C=function(e){let t=[];for(let i of e)switch(i.type){case p.RETRACT:t.splice(t.length-i.payload,i.payload);break;case p.MOVE:{let{r:e,c:r,p:s}=i.payload;t.push({r:e,c:r,p:s})}}return t}(y),N=z(C,v,f),S=1&C.length,R=N<0?y.length>0?U.X.PAUSED:U.X.PENDING:U.X.END,[w,P]=g.players,[x,I]=null!==(a=null==e?void 0:e.players)&&void 0!==a?a:[];return{elapsedTime:0,MAX_ROW:v,MAX_COL:f,status:R,winner:N,mover:S,pieces:C,instructions:y,gameTick:b,attemptTick:0,players:[{name:null!==(o=null==x?void 0:x.name)&&void 0!==o?o:w.name,type:null!==(n=null==x?void 0:x.type)&&void 0!==n?n:w.type,preference:{pieceFillStyle:null!==(l=null==x?void 0:null===(t=x.preference)||void 0===t?void 0:t.pieceFillStyle)&&void 0!==l?l:w.preference.pieceFillStyle,pieceStrokeStyle:null!==(c=null==x?void 0:null===(i=x.preference)||void 0===i?void 0:i.pieceStrokeStyle)&&void 0!==c?c:w.preference.pieceStrokeStyle}},{name:null!==(d=null==I?void 0:I.name)&&void 0!==d?d:P.name,type:null!==(h=null==I?void 0:I.type)&&void 0!==h?h:P.type,preference:{pieceFillStyle:null!==(u=null==I?void 0:null===(r=I.preference)||void 0===r?void 0:r.pieceFillStyle)&&void 0!==u?u:P.preference.pieceFillStyle,pieceStrokeStyle:null!==(m=null==I?void 0:null===(s=I.preference)||void 0===s?void 0:s.pieceStrokeStyle)&&void 0!==m?m:P.preference.pieceStrokeStyle}}],preference:(0,k.wT)(g.preference,null==e?void 0:e.preference)}}}),tf=e=>{let{storageKey:t,initialState:i}=e,r=(0,y.xo)(),s=(0,f.vc)(r.theme$);return(0,g.tZ)(tv,{storageKey:t,initialData:i,children:(0,g.tZ)(tu,{theme:s,children:(0,g.tZ)(th,{})})})};tf.displayName="GomokuGame";let ty=()=>(0,g.tZ)(tf,{storageKey:"@kyokuya/context-gomoku/#global"});ty.displayName="GameGomokuPageView"}},function(e){e.O(0,[354,74,32,4,810,595,138,800,971,69,744],function(){return e(e.s=945)}),_N_E=e.O()}]);