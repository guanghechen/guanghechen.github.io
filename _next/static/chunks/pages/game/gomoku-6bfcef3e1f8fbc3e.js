(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[921],{40193:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/game/gomoku",function(){return n(76385)}])},9171:function(e,t,n){"use strict";n.d(t,{D:function(){return l}});var r=n(55402),i=n(95050),a=n(67294);let o=[["#ffbe0b","#fb5607","#ff006e","#8338ec","#3a86ff"],["#9b5de5","#f15bb5","#fee440","#00bbf9","#00f5d4"]],s=()=>{let e=o.length;return o[Math.min(e-1,Math.floor(Math.random()*e))]},l=()=>{let e=a.useRef(!1),t=a.useRef(null);a.useEffect(()=>(t.current=new i.Z,()=>{t.current=null}),[]);let n=(0,r.$0)(async()=>{if(null==t.current)return;let n=t.current,r=s(),i=window.screen.width<=900;e.current=!0;try{await n.addConfetti({confettiColors:r,confettiRadius:i?4:8,confettiNumber:i?100:300})}finally{e.current=!1}});return n}},24729:function(e,t,n){"use strict";n.d(t,{ql:function(){return a},Ee:function(){return c},rU:function(){return g},BD:function(){return d},yj:function(){return p}});var r=n(9008),i=n.n(r);let a=i();var o=n(25675),s=n.n(o),l=n(67294);class c extends l.PureComponent{render(){return l.createElement(s(),this.props)}}let d=[{regex:/^@kyokuya\/_demo\/([\s\S]+)$/,importFunc:e=>()=>n(74243)("./".concat(e[1]))}];var u=n(11163);let p=()=>{let{asPath:e}=(0,u.useRouter)();return l.useMemo(()=>{var t;let n=null!==(t=e.split("#")[1])&&void 0!==t?t:null;return{path:e,hash:n}},[e])};var h=n(41664),m=n.n(h);class g extends l.PureComponent{render(){return l.createElement(m(),{...this.props,legacyBehavior:!1})}}},34781:function(e,t,n){"use strict";n.d(t,{p:function(){return s},X:function(){return i}}),(r=i||(i={}))[r.PENDING=1]="PENDING",r[r.RUNNING=2]="RUNNING",r[r.PAUSED=4]="PAUSED",r[r.END=8]="END";var r,i,a=n(76955),o=n(15658);class s extends a.jz{constructor(e){super();let t=new a.ZM(e.status),n=new a.ZM(e.elapsedTime),r=Date.now(),s=(e,t)=>{let a=Date.now();if(t===i.RUNNING){let e=a-r;n.setState(t=>t+e)}else e===i.PENDING&&n.setState(0);r=a};t.subscribe({next:(e,t)=>s(e,t),complete:()=>{}});let l=(0,o.iP)(()=>{let e=t.getSnapshot();s(e,e)});this.status$=t,this.elapsedTime$=n,this._disposables.push(new a.JT(l))}}},5576:function(e,t,n){"use strict";n.d(t,{tR:function(){return o},tm:function(){return s},OU:function(){return c},Qj:function(){return u}});var r=n(60459),i=n(24729),a=n(67294);function o(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"id",{hash:o}=(0,i.yj)(),[s,l]=a.useState(o);a.useEffect(()=>{if(null==s)return;let e=document.getElementById(s);null!=e&&e.scrollIntoView()},[]);let{onScroll:c,pauseWatchingScroll:d}=a.useMemo(()=>{let i=t-5,a=!1,o=(0,r.Ds)(function(){if(a)return;let t=function(e,t){let n=document.getElementsByClassName(e);for(let e=0;e<n.length;++e){let r=n[e];if(r.getBoundingClientRect().top>=t)return r}return n[n.length-1]}(e,i);if(null==t)return;let r=t.getAttribute(n);null!=r&&l(r)},50);return{onScroll:o,pauseWatchingScroll:e=>{a=!0,setTimeout(()=>{a=!1},e)}}},[e,t,n]);return{activatedIdentifier:s,refreshActivatedIdentifier:c,pauseWatchingScroll:d}}function s(){let[e,t]=a.useState(!1);return a.useEffect(()=>{let e=setTimeout(()=>t(!0),800);return()=>clearTimeout(e)},[]),e}var l=n(15658);function c(e,t){let n=a.useRef(0),r=a.useRef(null),i=(0,l.ei)(e,t);return(null===r.current||d(r.current,i,t))&&(n.current+=1),r.current=i,a.useMemo(()=>r.current,[n.current])}let d=(e,t,n)=>{for(let r of n)if(e[r]===t[r])return!0;return!1};function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,[n,i]=a.useState(0);return a.useEffect(()=>{let n=null===e?document.documentElement:e.current;if(null==n)return;let a=(0,r.Ds)(()=>{let e=n.scrollTop,t=n.scrollHeight-n.clientHeight;i(e/t)},t);a();let o=n===document.documentElement?window:n;return o.addEventListener("scroll",a),()=>o.removeEventListener("scroll",a)},[e,t]),n}},36435:function(e,t,n){"use strict";n.d(t,{DV:function(){return d},TS:function(){return m},Tl:function(){return x}});var r=n(85893),i=n(18872),a=n(36674),o=n(24729),s=n(15658),l=n(49894),c=n(67294);let d=e=>{let t=(0,a.mY)(e=>e.author$);return(0,r.jsx)(l.Z,{className:(0,i.cx)(u.container,e.className),url:t.about,title:"about",onClick:s.UW,children:(0,r.jsx)(o.Ee,{alt:"avatar",src:t.avatar})})},u={container:(0,i.iv)({display:"inline-block",boxSizing:"border-box",transition:"all 0.3s",padding:0,borderRadius:"50%",margin:0,overflow:"hidden",background:"#88acdb",textAlign:"center",userSelect:"none","&:hover":{transform:"scale(1.1) rotate(360deg)"},"&>img":{boxSizing:"border-box",display:"inline-block",width:"100%",height:"100%"}})};var p=n(45697),h=n.n(p);let m=e=>{let t=(0,a.mY)(e=>e.title$),n=(0,a.mY)(e=>e.description$),i=(0,a.mY)(e=>e.author$),{description:s=n,title:l}=e;return(0,r.jsxs)(o.ql,{children:[(0,r.jsxs)("title",{children:[l," | ",t]}),(0,r.jsx)("meta",{name:"viewport",content:"initial-scale=1.0, width=device-width"},"viewport"),(0,r.jsx)("meta",{name:"author",content:i.name},"author"),(0,r.jsx)("meta",{name:"description",content:s},"description"),(0,r.jsx)("meta",{property:"og:title",content:l},"og:title"),(0,r.jsx)("meta",{property:"og:description",content:s},"og:description"),(0,r.jsx)("meta",{property:"og:type",content:"website"},"og:type")]})};m.propTypes={title:h().string.isRequired,description:h().string};var g=n(94101),f=n(14651),v=n(24366);let x=e=>{let t=(0,a.O5)(),n=(0,a.mY)(e=>e.theme$),o=n===g.Q2.darken,s=c.useCallback(e=>{e.stopPropagation(),t({type:a.Jx.TOGGLE_THEME,payload:o?g.Q2.light:g.Q2.darken})},[t,o]),l=o?v.Z:f.Z;return(0,r.jsx)("div",{className:(0,i.cx)(y.container,e.className),children:(0,r.jsx)(l,{className:y.icon,onClick:s})})};x.propTypes={className:h().string};let y={container:(0,i.iv)({cursor:"pointer"}),icon:(0,i.iv)({height:24,width:24,color:"hsl(55deg, 40%, 60%)"})}},64712:function(e,t,n){"use strict";n.d(t,{V:function(){return c}});var r=n(85893),i=n(36674),a=n(16378),o=n(15658),s=n(36435),l=n(67294);let c=e=>{let t=(0,i.mY)(e=>e.author$),n=(0,i.mY)(e=>e.copyright$);return(0,r.jsxs)(l.Fragment,{children:[(0,r.jsx)(s.TS,{title:e.title,description:e.description}),(0,r.jsxs)("div",{className:d.container,children:[(0,r.jsxs)("header",{className:d.header,children:[(0,r.jsx)("h1",{className:d.title,children:e.title}),(0,r.jsxs)("div",{className:d.toolbarButtons,children:[(0,r.jsx)(s.Tl,{className:d.themeToggle}),(0,r.jsx)(s.DV,{className:d.authorAvatar})]})]}),(0,r.jsx)("main",{className:d.main,children:(0,r.jsx)("div",{className:d.content,children:e.children})}),(0,r.jsx)("footer",{className:d.footer,children:(0,r.jsxs)("div",{className:d.copyright,children:[(0,r.jsxs)("span",{children:["\xa9 ",n.date," ",t.name]},"date"),(0,r.jsx)("span",{children:t.motto},"motto")]})})]})]})},d=(0,o.ZC)({container:{position:"relative",boxSizing:"border-box",display:"flex",flexDirection:"column",width:"100vw",minHeight:"100vh",background:a.TV.colorBgBody},header:{flex:"0 0 auto",alignItems:"center",display:"flex",boxSizing:"border-box",background:a.TV.colorBgHeader},title:{flex:"1 1 auto",color:"#696969",textAlign:"center",fontFamily:"'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB',\n          'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif",margin:"1rem 0"},toolbarButtons:{flex:"0 0 auto",display:"flex",alignItems:"center"},themeToggle:{marginRight:16,width:24,height:24},authorAvatar:{marginRight:16,width:24,height:24},main:{flex:"1 0 auto",boxSizing:"border-box",width:"100%",marginBottom:"2rem",background:a.TV.colorBgBody},footer:{flex:"0 0 auto",boxSizing:"border-box",width:"100%",padding:"1rem",lineHeight:"2",color:"hsla(0deg, 0%, 85%, 0.8)",background:"hsl(0deg, 0%, 20%)",fontSize:"max(0.8rem, 12px)",fontFamily:"'Andale Mono', 'lucida grande', 'lucida sans unicode', lucida, helvetica,\n        'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif",textShadow:"0 1px #333"},content:{flex:"1 0 auto",boxSizing:"border-box",display:"flex",justifyContent:"center"},copyright:{display:"flex",justifyContent:"space-between",maxWidth:400,margin:"auto",userSelect:"none"}})},49894:function(e,t,n){"use strict";n.d(t,{Z:function(){return g}});var r=n(85893),i=n(67294),a=n(18872),o=n(8190);let s={link:(0,a.iv)({padding:"0.2rem 0",color:o.TV.colorLink,textDecoration:"none",background:"linear-gradient( 90deg, hsla(358deg, 100%, 62%, 0.8), hsla(048deg, 100%, 50%, 0.8), hsla(196deg, 100%, 53%, 0.8))",backgroundSize:"0 3px",backgroundRepeat:"no-repeat",backgroundPosition:"50% 100%",transition:"all 0.3s ease-in-out","&:visited":{color:o.TV.colorLink},"&:hover":{color:o.TV.colorLinkHover,backgroundSize:"100% 3px",backgroundPositionX:0}})};class l extends i.PureComponent{render(){let{children:e,className:t,url:n,rel:i="noopener,noreferrer",target:o="_blank",title:l,...c}=this.props;return(0,r.jsx)("a",{...c,className:(0,a.cx)(s.link,t),href:n,title:l,target:o,rel:i,children:e})}}var c=n(24729);class d extends i.PureComponent{render(){let{children:e,className:t,url:n,title:i,...o}=this.props;return(0,r.jsx)(c.rU,{...o,className:(0,a.cx)(s.link,t),href:n,title:i,children:e})}}var u=n(45697),p=n.n(u);let h={url:p().string.isRequired,title:p().string,children:p().node,className:p().string,rel:p().string,style:p().object,target:p().string};class m extends i.PureComponent{render(){let{url:e,title:t,children:n}=this.props;return/^#/.test(e)?(0,r.jsx)("a",{title:t,href:e,children:n}):/^(\w+:[/]{2})/.test(e)?i.createElement(l,this.props):i.createElement(d,this.props)}}m.propTypes=h;var g=m},76385:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return td}});var r,i,a,o,s,l,c,d=n(85893),u=n(45697),p=n.n(u),h=n(67294);let m="2023-06-10";(r=o||(o={})).FLIP_PLAYER="@gomoku/flip-player",r.MODIFY_PLAYER="@gomoku/modify-player",r.MODIFY_PREFERENCE="@gomoku/modify-preference",r.MOVE="@gomoku/move",r.PAUSE="@gomoku/pause",r.RESET="@gomoku/reset",r.RESTART="@gomoku/restart",r.RESUME="@gomoku/resume",r.RETRACT="@gomoku/retract",r.START="@gomoku/start",(i=s||(s={})).MOVE="move",i.RETRACT="retract",(a=l||(l={})).HUMAN="human",a.COMPUTER="computer",a.STUPID_COMPUTER="stupid-computer";var g=n(59976);let f=h.createContext(null);f.displayName="GomokuContextType";let v=()=>{let e=h.useContext(f);return e.dispatch},x=e=>{let t=h.useContext(f),n=e(t);return(0,g.vc)(n)};var y=n(34781),b=n(35369),k=n(26812);let C=k.a7.rightHalf,N=e=>e===l.COMPUTER||e===l.STUPID_COMPUTER;function S(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,i=new Int32Array(t*n).fill(-1);for(let{r:n,c:r,p:a}of e)i[n*t+r]=a;let a=(e,n)=>e*t+n,o=(e,r)=>e>=0&&e<t&&r>=0&&r<n;for(let e of C){let[s,l]=k.bs[e];for(let e=0;e<t;++e)for(let t=0;t<n;++t){let n=i[a(e,t)];if(n<0)continue;let c=1;for(let r=e+s,d=t+l;o(r,d)&&i[a(r,d)]===n;r+=s,d+=l)c+=1;if(c>=r){if(0!==n&&1!==n)throw Error("[checkWinner] Bad player(".concat(n,") on piece (").concat(e,", ").concat(t,")."));return n}}}return -1}class w{constructor(e){var t=this;this.restart=()=>{let e=this.viewmodel,t=e.status$.getSnapshot();t!==y.X.PENDING&&(e.status$.next(y.X.PENDING),e.winner$.next(-1),e.mover$.next(0),e.pieces$.next(b.aV.of()),e.instructions$.next(b.aV.of()),e.gameTick$.setState(e=>e+1),e.attemptTick$.next(0))},this.reset=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.viewmodel,r=n.status$.getSnapshot();r===y.X.PENDING&&(e.MAX_ROW&&n.MAX_ROW$.next(e.MAX_ROW),e.MAX_COL&&n.MAX_COL$.next(e.MAX_COL),n.status$.next(y.X.PENDING),n.winner$.next(-1),n.mover$.next(0),n.pieces$.next(b.aV.of()),n.instructions$.next(b.aV.of()),n.gameTick$.setState(e=>e+1),n.attemptTick$.next(0))},this.start=()=>{let e=this.viewmodel,t=e.status$.getSnapshot();t===y.X.PENDING&&e.status$.next(y.X.RUNNING)},this.pause=()=>{let e=this.viewmodel,t=e.status$.getSnapshot();t===y.X.RUNNING&&e.status$.next(y.X.PAUSED)},this.resume=()=>{let e=this.viewmodel,t=e.status$.getSnapshot();t===y.X.PAUSED&&e.status$.next(y.X.RUNNING)},this.move=(e,t)=>{let n=this.viewmodel,r=n.status$.getSnapshot();if(r!==y.X.RUNNING)return;let i=n.pieces$.getSnapshot();if(i.some(n=>n.r===e&&n.c===t))return;let a=n.MAX_ROW$.getSnapshot(),o=n.MAX_COL$.getSnapshot(),l=n.mover$.getSnapshot(),c={r:e,c:t,p:l},d=i.push(c),u=S(d,a,o),p=u>=0||d.size===a*o;p&&n.status$.next(y.X.END),n.winner$.next(u),n.pieces$.next(d),n.mover$.next(1^l),n.attemptTick$.setState(e=>e+1),n.instructions$.setState(e=>e.push({type:s.MOVE,payload:c,timestamp:new Date().toISOString()}))},this.retract=()=>{let e=this.viewmodel,t=e.status$.getSnapshot();if(t!==y.X.RUNNING&&t!==y.X.END)return;let n=e.mover$.getSnapshot(),r=e.pieces$.getSnapshot(),i=r.findLastIndex(e=>e.p===n);if(i<0)return;let a=r.size-i,o=r.slice(0,i),l=1&o.size;e.status$.next(y.X.RUNNING),e.pieces$.next(o),e.winner$.next(-1),e.mover$.next(l),e.attemptTick$.setState(e=>e+1),e.instructions$.setState(e=>e.push({type:s.RETRACT,payload:a,timestamp:new Date().toISOString()}))},this.flipPlayer=()=>{let e=this.viewmodel,t=e.status$.getSnapshot();if(t!==y.X.PENDING)return;let[n,r]=e.players$.getSnapshot();e.players$.next([r,n])},this.modifyPlayer=e=>{var t,n,r,i;let a=this.viewmodel,o=a.status$.getSnapshot();if(o===y.X.END)return;if(0!==e.id&&1!==e.id){console.error("[Bad action] modifyPlayer",e);return}let s=a.players$.getSnapshot()[e.id],l={name:e.name||s.name,type:e.type||s.type,preference:{pieceFillStyle:null!==(r=null===(t=e.preference)||void 0===t?void 0:t.pieceFillStyle)&&void 0!==r?r:s.preference.pieceFillStyle,pieceStrokeStyle:null!==(i=null===(n=e.preference)||void 0===n?void 0:n.pieceStrokeStyle)&&void 0!==i?i:s.preference.pieceStrokeStyle}};a.players$.setState(t=>t.map((t,n)=>n===e.id?l:t))},this.modifyPreference=e=>{let t=this.viewmodel,n=t.status$.getSnapshot();n!==y.X.END&&t.preference$.setState(t=>({...t,...e}))},this.viewmodel=e.viewmodel}}var E=n(60459),R=n(55402),j=n(15658),M=n(45684),_=n(13339);function $(e){var t,n,r,i,a,o,l,c,d,u,p,h,m;let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:T,{MAX_ROW:f=g.MAX_ROW,MAX_COL:v=g.MAX_COL,instructions:x=g.instructions.slice(),gameTick:b=g.gameTick}={...e},k=function(e){let t=[];for(let n of e)switch(n.type){case s.RETRACT:t.splice(t.length-n.payload,n.payload);break;case s.MOVE:{let{r:e,c:r,p:i}=n.payload;t.push({r:e,c:r,p:i})}}return t}(x),C=S(k,f,v),N=1&k.length,w=C<0?x.length>0?y.X.PAUSED:y.X.PENDING:y.X.END,[E,R]=g.players,[M,_]=null!==(a=null==e?void 0:e.players)&&void 0!==a?a:[];return{elapsedTime:0,MAX_ROW:f,MAX_COL:v,status:w,winner:C,mover:N,pieces:k,instructions:x,gameTick:b,attemptTick:0,players:[{name:null!==(o=null==M?void 0:M.name)&&void 0!==o?o:E.name,type:null!==(l=null==M?void 0:M.type)&&void 0!==l?l:E.type,preference:{pieceFillStyle:null!==(c=null==M?void 0:null===(t=M.preference)||void 0===t?void 0:t.pieceFillStyle)&&void 0!==c?c:E.preference.pieceFillStyle,pieceStrokeStyle:null!==(d=null==M?void 0:null===(n=M.preference)||void 0===n?void 0:n.pieceStrokeStyle)&&void 0!==d?d:E.preference.pieceStrokeStyle}},{name:null!==(u=null==_?void 0:_.name)&&void 0!==u?u:R.name,type:null!==(p=null==_?void 0:_.type)&&void 0!==p?p:R.type,preference:{pieceFillStyle:null!==(h=null==_?void 0:null===(r=_.preference)||void 0===r?void 0:r.pieceFillStyle)&&void 0!==h?h:R.preference.pieceFillStyle,pieceStrokeStyle:null!==(m=null==_?void 0:null===(i=_.preference)||void 0===i?void 0:i.pieceStrokeStyle)&&void 0!==m?m:R.preference.pieceStrokeStyle}}],preference:(0,j.wT)(g.preference,null==e?void 0:e.preference)}}let T={MAX_ROW:15,MAX_COL:15,status:y.X.PENDING,elapsedTime:0,winner:-1,mover:0,pieces:[],instructions:[],gameTick:0,attemptTick:0,players:[{name:"guanghechen",type:l.COMPUTER,preference:{pieceFillStyle:{prefer:"image",imageUrl:"/asset/img/gomoku/guanghechen.jpg"}}},{name:"wulala",type:l.HUMAN,preference:{pieceFillStyle:{prefer:"image",imageUrl:"/asset/img/gomoku/wulala.jpg"}}}],preference:{borderColor:{r:255,g:255,b:255,a:1},locatePointColor:{r:51,g:51,b:51,a:1},boardBackground:{prefer:"color",color:{r:230,g:226,b:222,a:1},imageUrl:"/asset/img/gomoku/board.jpg"}}};class P extends y.p{_consume(e){let t=this._controller;switch(e.type){case o.RESTART:t.restart();break;case o.RESET:t.reset(e.payload);break;case o.START:t.start();break;case o.PAUSE:t.pause();break;case o.RESUME:t.resume();break;case o.MOVE:{let{r:n,c:r}=e.payload;t.move(n,r);break}case o.RETRACT:t.retract();break;case o.FLIP_PLAYER:t.flipPlayer();break;case o.MODIFY_PLAYER:t.modifyPlayer(e.payload);break;case o.MODIFY_PREFERENCE:t.modifyPreference(e.payload);break;default:console.error(this.constructor.name,"Bad action:",e)}}constructor(e){super(e),this.getSnapshot=()=>({status:this.status$.getSnapshot(),elapsedTime:this.elapsedTime$.getSnapshot(),MAX_ROW:this.MAX_ROW$.getSnapshot(),MAX_COL:this.MAX_COL$.getSnapshot(),winner:this.winner$.getSnapshot(),mover:this.mover$.getSnapshot(),pieces:Array.from(this.pieces$.getSnapshot()),instructions:Array.from(this.instructions$.getSnapshot()),gameTick:this.gameTick$.getSnapshot(),attemptTick:this.attemptTick$.getSnapshot(),players:this.players$.getSnapshot(),preference:this.preference$.getSnapshot()}),this.MAX_ROW$=new g.ZM(e.MAX_ROW),this.MAX_COL$=new g.ZM(e.MAX_COL),this.winner$=new g.ZM(e.winner),this.mover$=new g.ZM(e.mover),this.pieces$=new g.ZM(b.aV.of(...e.pieces)),this.instructions$=new g.ZM(b.aV.of(...e.instructions)),this.gameTick$=new g.ZM(e.gameTick),this.attemptTick$=new g.ZM(e.attemptTick),this.players$=new g.ZM(e.players),this.preference$=new g.ZM(e.preference);let t=new w({viewmodel:this});this._controller=t}}let I=e=>{let{storageKey:t,LoadingComponent:n=M.gb}=e,[r,i]=h.useState(void 0),a=h.useMemo(()=>t?(0,_.Yu)(t):void 0,[t]),o=h.useRef(e.initialData);return(h.useEffect(()=>{e();async function e(){let e=await o.current;if(a){let t=await a.load();null==t||t.version!==m?i(new P($(e))):i(new P($({...t.data,...e})))}else i(new P($(e)))}},[a]),h.useEffect(()=>{if(r)return()=>{console.log("[waw] unmounting gomoku viewmodel."),r.dispose()}},[r]),r)?(0,d.jsxs)(h.Fragment,{children:[(0,d.jsx)(f.Provider,{value:r,children:e.children}),a&&(0,d.jsx)(A,{viewmodel:r,storage:a,storageKey:t})]}):(0,d.jsx)(n,{})},A=e=>{let{viewmodel:t,storage:n,storageKey:r}=e,i=(0,g.sD)(t,["MAX_ROW$","MAX_COL$","winner$","instructions$","gameTick$","players$","preference$"]),a=h.useMemo(()=>(0,E.P2)(()=>{let e={MAX_ROW:t.MAX_ROW$.getSnapshot(),MAX_COL:t.MAX_COL$.getSnapshot(),winner:t.winner$.getSnapshot(),instructions:Array.from(t.instructions$.getSnapshot()),gameTick:t.gameTick$.getSnapshot(),players:Array.from(t.players$.getSnapshot()),preference:t.preference$.getSnapshot()};return j.kg.log("saving ".concat(r,". data:"),e),n.save({version:m,data:e})},200),[t,n,r]);return h.useEffect(()=>void a(),[a,i]),(0,R.i7)(()=>a.flushSync(),[],!1),(0,d.jsx)(h.Fragment,{})};var D=n(18872),O=n(94054),X=n(72890),U=n(74750),Z=n(36872),G=n(83321),F=n(30780);let L=e=>{let{background:t,onBackgroundChange:n,onVisibleChange:r}=e,i={onPickerClicked:j.UW,onClosePicker:(0,R.$0)(e=>r(!1)),onPreferChange:(0,R.$0)((e,r)=>{let i={prefer:r,imageUrl:t.imageUrl,color:t.color};n(i)}),onColorChange:(0,R.$0)(e=>{let r={prefer:"color",imageUrl:t.imageUrl,color:e.rgb};n(r)}),onImageChange:e=>{let r=e.target.files;if(null!==r){let e=new FileReader;e.readAsDataURL(r[0]),e.onload=e=>{var r;let i=null===(r=e.target)||void 0===r?void 0:r.result;if(null!=i){let e={prefer:"image",color:t.color,imageUrl:String(i)};n(e)}}}}},a=h.useId();return(0,d.jsxs)("div",{className:(0,D.cx)(z.container,!e.visible&&z.invisible,e.className),onClick:i.onPickerClicked,children:[(0,d.jsx)("div",{className:z.cover,onClick:i.onClosePicker}),(0,d.jsxs)("div",{className:z.backgroundPicker,children:[(0,d.jsx)("div",{className:z.backgroundPrefer,children:(0,d.jsx)(O.Z,{style:{display:"flex",justifyContent:"center"},children:(0,d.jsxs)(X.Z,{className:z.backgroundRadioGroup,value:t.prefer,onChange:i.onPreferChange,children:[(0,d.jsx)(U.Z,{value:"color",control:(0,d.jsx)(Z.Z,{}),label:"color"}),(0,d.jsx)(U.Z,{value:"image",control:(0,d.jsx)(Z.Z,{}),label:"image"})]})})}),(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:(0,D.cx)(z.colorPickerWrapper,"color"!==t.prefer&&z.invisible),onDoubleClick:i.onClosePicker,children:(0,d.jsx)(F.xS,{className:z.colorPicker,color:t.color,onChange:i.onColorChange})}),(0,d.jsxs)("div",{className:(0,D.cx)(z.imagePickerWrapper,"image"!==t.prefer&&z.invisible),children:[(0,d.jsx)("input",{type:"file",accept:"image/*",id:a,style:{display:"none"},multiple:!1,onChange:i.onImageChange}),(0,d.jsx)("label",{htmlFor:a,children:(0,d.jsx)(G.Z,{className:z.imageUploadBtn,variant:"contained",component:"span",children:(0,d.jsx)("img",{alt:"background",src:t.imageUrl})})})]})]})]})]})},z=(0,j.ZC)({container:{position:"absolute",zIndex:20,top:"20px"},invisible:{"&&":{display:"none",visibility:"hidden"}},cover:{position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px",cursor:"default"},backgroundPicker:{display:"flex",flexDirection:"column",minWidth:"220px",border:"1px solid #e6e6e6",borderRadius:"4px",boxShadow:"rgba(0, 0, 0, 0.15) 0px 0px 0px 1px, rgba(0, 0, 0, 0.15) 0px 8px 16px",background:"#fff"},backgroundPrefer:{flex:"0 0 auto",borderBottom:"1px solid rgba(0, 0, 0, 0.15)",userSelect:"none"},backgroundRadioGroup:{"&&":{display:"flex",flexDirection:"row",justifyContent:"center"}},imagePickerWrapper:{boxSizing:"border-box",display:"flex",justifyContent:"center",alignItems:"center",width:"220px",height:"220px","& img":{display:"inline-block",width:"200px",height:"200px"}},colorPickerWrapper:{display:"block"},colorPicker:{border:"none !important",borderRadius:"0px !important",boxShadow:"none !important"},imageUploadBtn:{"&&":{background:"none",padding:"0px",margin:"0px"}}}),W=e=>{let{color:t,onColorChange:n,onVisibleChange:r}=e,i={onClosePicker:(0,R.$0)(()=>r(!1)),onColorChange:(0,R.$0)(e=>n(e.rgb))};return(0,d.jsxs)("div",{className:(0,D.cx)(B.container,!e.visible&&B.invisible,e.className),children:[(0,d.jsx)("div",{className:B.cover,onClick:i.onClosePicker}),(0,d.jsx)("div",{className:B.picker,onDoubleClick:i.onClosePicker,children:(0,d.jsx)(F.xS,{className:B.colorPicker,color:t,onChange:i.onColorChange})})]})},B=(0,j.ZC)({container:{position:"absolute",zIndex:20,top:"20px",display:"block",visibility:"visible"},invisible:{"&&":{display:"none",visibility:"hidden"}},cover:{position:"fixed",top:0,right:0,bottom:0,left:0},picker:{display:"flex",flexDirection:"column",minWidth:"220px",border:"1px solid #e6e6e6",borderRadius:"4px",boxShadow:"rgba(0, 0, 0, 0.15) 0px 0px 0px 1px, rgba(0, 0, 0, 0.15) 0px 8px 16px",background:"#fff"},colorPicker:{border:"none !important",borderRadius:"0 !important",boxShadow:"none !important",caretColor:"transparent"}});var H=n(8802);let V=e=>{let[t,n]=h.useState(!1),r={onAvatarClick:(0,R.$0)(e=>{e.stopPropagation(),n(!0)})},i=q(e.position,e.avatar,e.disabled,e.thinking,e.running);return(0,d.jsxs)("div",{className:(0,D.cx)(i.container,e.className),onClick:e.onEdit,children:[(0,d.jsxs)("div",{className:i.userWrapper,children:[(0,d.jsx)("span",{className:i.name,children:e.name}),(0,d.jsx)("span",{className:i.type,children:e.type})]}),(0,d.jsx)("div",{className:i.avatar,onClick:r.onAvatarClick,children:(0,d.jsx)(H.Z,{className:i.thinkingIcon})}),(0,d.jsx)(L,{className:i.picker,visible:t,background:e.avatar,onVisibleChange:n,onBackgroundChange:e.onAvatarChange})]})},q=(e,t,n,r,i)=>h.useMemo(()=>(0,j.ZC)({container:{position:"relative",display:"flex",flexDirection:"left"===e?"row":"row-reverse",justifyContent:"flex-end",alignItems:"center",lineHeight:"16px",cursor:n?"default":"pointer"},avatar:{position:"relative",width:32,height:32,borderRadius:"50%",margin:"left"===e?"0 0 0 6px":"0 6px 0 0",background:(0,j.l9)(t),backgroundSize:"cover"},userWrapper:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"left"===e?"flex-end":"flex-start",lineHeight:"16px"},name:{display:"flex",alignItems:"center",color:"#4682b4",fontSize:16,userSelect:"none"},thinkingIcon:{"&&":{position:"absolute",top:0,left:"left"===e?void 0:-20,right:"left"===e?-20:void 0,display:"inline-block",visibility:r?"visible":"hidden",transition:"translate(0, -50%)",width:16,height:16,color:"#69696e",userSelect:"none",animation:i?"1s ease-in 0s ".concat(Y.thinkingIcon," infinite alternate both"):void 0}},type:{margin:"4px 0",fontSize:14,userSelect:"none"},picker:{"&&":"left"===e?{top:48,left:16}:{top:48,left:"unset",right:16}}}),[e,t,n,r,i]),Y={thinkingIcon:(0,D.F4)({"0%":{transform:"rotate(-30deg) scale(1.0)"},"50%":{transform:"rotate(0deg) scale(1.2)"},"100%":{transform:"rotate(30deg) scale(1.0)"}})};function K(e){var t,n,r;let{data:i,items:a,itemsOrder:o,colon:s=":",onChange:l}=e,c={formItem:(0,D.cx)(J.formItem,null===(t=e.classes)||void 0===t?void 0:t.formItem),label:(0,D.cx)(J.label,null===(n=e.classes)||void 0===n?void 0:n.label),content:(0,D.cx)(J.content,null===(r=e.classes)||void 0===r?void 0:r.content)},u=o.map((e,t)=>{let n=a[e];return(0,d.jsxs)("div",{className:c.formItem,children:[(0,d.jsxs)("div",{className:c.label,children:[n.label,s]}),(0,d.jsx)("div",{className:c.content,children:(0,d.jsx)(Q,{name:e,value:i[e],disabled:n.disabled,required:n.required,ContentRenderer:n.ContentRenderer,onChange:l})})]},t)});return(0,d.jsx)(h.Fragment,{children:u})}function Q(e){let{ContentRenderer:t}=e,n=(0,R.$0)(t=>{e.onChange({[e.name]:t})});return(0,d.jsx)(t,{value:e.value,disabled:e.disabled,required:e.required,onChange:n})}let J=(0,j.ZC)({formItem:{display:"flex",alignItems:"flex-start"},label:{flex:"0 1 auto",display:"inline-flex",justifyContent:"flex-end",alignItems:"flex-start",marginRight:8,userSelect:"none",height:"100%"},content:{flex:"1 1 auto",display:"inline-flex",justifyContent:"flex-start",alignItems:"flex-start",height:"100%"}});var ee=n(26692),et=n(5576),en=n(78262),er=n(9581),ei=n(31425);function ea(e){var t,n,r;let[i]=h.useState(e.initialData),[a,o]=h.useState(i),s=null!==(n=e.factoryData)&&void 0!==n?n:i,l=(0,ee.Z)(i,a),c=(0,ee.Z)(s,a),u=(null===(r=e.isResetAvailable)||void 0===r||r)&&!c,p={onConfirm:(0,R.$0)(()=>e.onSave(a)),onDiscard:(0,R.$0)(()=>e.onDiscard(i)),onChange:(0,R.$0)(t=>{var n;let r={...a,...t};o(r),null===(n=e.onRealTimeChange)||void 0===n||n.call(e,r)}),onReset:(0,R.$0)(()=>{var t;let n={...s};o(n),null!=e.onReset?e.onReset():null===(t=e.onRealTimeChange)||void 0===t||t.call(e,n)}),onClose:(0,R.$0)(()=>{l&&e.onDiscard(i)})};(0,R.TK)(()=>p.onDiscard(),[]);let m=e.formGroups.map((e,t)=>(0,d.jsx)(eo,{data:a,keys:e.keys,Component:e.Component,onChange:p.onChange},t));return(0,d.jsxs)(en.Z,{"aria-labelledby":"edit-player",container:e.container,open:!0,onClose:p.onClose,children:[(0,d.jsx)(er.Z,{className:(0,D.cx)(es.dialog,null===(t=e.classes)||void 0===t?void 0:t.dialog),children:m}),(0,d.jsxs)(ei.Z,{children:[null!=e.factoryData&&(0,d.jsx)(G.Z,{color:"inherit",disabled:!u,onClick:p.onReset,children:"Reset"}),(0,d.jsx)(G.Z,{color:"inherit",onClick:p.onDiscard,children:"Discard"}),(0,d.jsx)(G.Z,{color:"primary",disabled:l,onClick:p.onConfirm,children:"Save"})]})]})}function eo(e){let{Component:t,onChange:n}=e,r=(0,et.OU)(e.data,e.keys);return h.useMemo(()=>(0,d.jsx)(t,{data:r,onChange:n}),[t,r,n])}let es=(0,j.ZC)({dialog:{minWidth:240,minHeight:300}}),el=e=>{let{componentName:t}=e,n=e=>{let{value:t,disabled:n}=e,[r,i]=h.useState(!1),a={onTogglePickerVisible:(0,R.$0)(()=>{n||i(e=>!e)}),onBackgroundChange:(0,R.$0)(t=>{n||e.onChange(t)})},o=ec(t,n);return(0,d.jsxs)("div",{className:o.container,children:[(0,d.jsx)("div",{className:o.swatch,onClick:a.onTogglePickerVisible,children:(0,d.jsx)("div",{className:o.colorSquare})}),(0,d.jsx)(L,{className:o.picker,visible:r,background:t,onVisibleChange:i,onBackgroundChange:a.onBackgroundChange})]})};return n.displayName=null!=t?t:"FormItemBackground",n},ec=(e,t)=>(0,j.ZC)({container:{display:"flex",alignItems:"center",caretColor:"transparent"},swatch:{display:"inline-block",padding:3,border:"1px solid rgba(0,0,0,.2)",borderRadius:"1px",background:"#fff",cursor:t?"default":"pointer"},colorSquare:"image"===e.prefer?{width:32,height:32,borderRadius:2,background:(0,j.l9)(e),backgroundSize:"cover"}:{width:32,height:12,borderRadius:2,background:(0,j.l9)(e),backgroundSize:"cover"},picker:{"&&":{left:30}}}),ed=e=>{let{componentName:t}=e,n=e=>{let{value:t,disabled:n}=e,[r,i]=h.useState(!1),a={onTogglePickerVisible:(0,R.$0)(()=>{n||i(e=>!e)}),onColorChange:(0,R.$0)(t=>{n||e.onChange(t)})},o=eu(t,n);return(0,d.jsxs)("div",{className:o.container,children:[(0,d.jsx)("div",{className:o.swatch,onClick:a.onTogglePickerVisible,children:(0,d.jsx)("div",{className:o.colorSquare})}),(0,d.jsx)(W,{className:o.picker,visible:r,color:t,onVisibleChange:i,onColorChange:a.onColorChange})]})};return n.displayName=null!=t?t:"FormItemColor",n},eu=(e,t)=>(0,j.ZC)({container:{display:"flex",alignItems:"center",caretColor:"transparent"},swatch:{display:"inline-block",padding:3,border:"1px solid rgba(0,0,0,.2)",borderRadius:"1px",background:"#fff",cursor:t?"default":"pointer"},colorSquare:{width:32,height:12,borderRadius:2,backgroundColor:(0,j.xv)(e)},picker:{"&&":{left:30}}});var ep=n(55819),eh=n(45018);let em=e=>{let{choices:t,componentName:n,normalize:r=e=>e}=e,i=Array.isArray(t)?t.map(e=>(0,d.jsx)(ep.Z,{value:e,children:e},e)):Object.keys(t).map(e=>(0,d.jsx)(ep.Z,{value:e,children:t[e]},e)),a=e=>{let t={onChange:(0,R.$0)(t=>{let n=r(t.target.value);e.onChange(n)})};return(0,d.jsx)(eh.Z,{variant:"standard",required:e.required,disabled:e.disabled,value:e.value,onChange:t.onChange,children:i})};return a.displayName=null!=n?n:"FormItemEnum",a};var eg=n(98271);let ef=e=>{let{componentName:t}=e,n=e=>{let[t,n]=(0,R.nu)(e.value),r={onChange:(0,R.$0)(e=>{n(e.target.value)}),onBlur:(0,R.$0)(()=>{e.onChange(t)})};return(0,d.jsx)(eg.Z,{variant:"standard",disabled:e.disabled,required:e.required,value:t,onChange:r.onChange,onBlur:r.onBlur})};return n.displayName=null!=t?t:"FormItemString",n},ev=["name","type","pieceFill"],ex={keys:ev,Component:e=>{let t=x(e=>e.status$),n=t===y.X.PENDING,r=t===y.X.END,i=h.useMemo(()=>({name:{label:"Name",disabled:r,ContentRenderer:ef({componentName:"GomokuSettingPlayerName"})},type:{label:"Type",disabled:!n,ContentRenderer:em({componentName:"GomokuSettingPlayerType",choices:[l.HUMAN,l.COMPUTER,l.STUPID_COMPUTER]})},pieceFill:{label:"Avatar",disabled:r,ContentRenderer:el({componentName:"GomokuSettingPlayerAvatar"})}}),[n,r]);return(0,d.jsx)(K,{data:e.data,items:i,itemsOrder:ev,classes:ey,onChange:e.onChange})}},ey=(0,j.ZC)({formItem:{margin:"1rem 1rem",alignItems:"center"},label:{minWidth:"6rem"}}),eb=e=>{let{playerId:t}=e,n=v(),r=x(e=>e.status$),i=x(e=>e.players$)[t],a=h.useMemo(()=>{let e=T.players[t];return{name:e.name,type:e.type,pieceFill:e.preference.pieceFillStyle,pieceStroke:e.preference.pieceStrokeStyle}},[t]),s=h.useMemo(()=>({name:i.name,type:i.type,pieceFill:i.preference.pieceFillStyle,pieceStroke:i.preference.pieceStrokeStyle}),[i]),l=h.useMemo(()=>[ex],[]),c=r===y.X.END,u={onRealTimeChange:(0,R.$0)(e=>{n({type:o.MODIFY_PLAYER,payload:{id:t,type:e.type,name:e.name,preference:(0,j.S4)({pieceFillStyle:e.pieceFill,pieceStrokeStyle:e.pieceStroke})}})}),onSave:t=>{u.onRealTimeChange(t),e.onClose()},onDiscard:(0,R.$0)(t=>{u.onRealTimeChange(t),e.onClose()})};return(0,d.jsx)(h.Fragment,{children:e.visible&&(0,d.jsx)(ea,{container:e.containerRef.current,initialData:s,factoryData:a,isResetAvailable:!c,formGroups:l,classes:ek,onSave:u.onSave,onDiscard:u.onDiscard,onRealTimeChange:u.onRealTimeChange})})},ek=(0,j.ZC)({dialog:{minWidth:240,minHeight:400}}),eC=e=>{let t=v(),n=x(e=>e.status$),r=x(e=>e.mover$),[i,a]=x(e=>e.players$),[s,l]=h.useState(null),c=n===y.X.RUNNING,u=n===y.X.PENDING,p={onCancel:(0,R.$0)(()=>l(null)),onEditPlayer0:(0,R.$0)(()=>l(0)),onEditPlayer1:(0,R.$0)(()=>l(1)),onPlayer0AvatarChange:(0,R.$0)(e=>{t({type:o.MODIFY_PLAYER,payload:{id:0,preference:{pieceFillStyle:e}}})}),onPlayer1AvatarChange:(0,R.$0)(e=>{t({type:o.MODIFY_PLAYER,payload:{id:1,preference:{pieceFillStyle:e}}})})},m=eN();return(0,d.jsxs)("div",{className:m.container,children:[(0,d.jsx)(V,{position:"left",className:m.player0,name:i.name,type:i.type,avatar:i.preference.pieceFillStyle,disabled:!u,running:c,thinking:0===r,onEdit:p.onEditPlayer0,onAvatarChange:p.onPlayer0AvatarChange},"player0"),(0,d.jsx)("span",{className:m.versus,children:"VS"}),(0,d.jsx)(V,{position:"right",className:m.player1,name:a.name,type:a.type,avatar:a.preference.pieceFillStyle,disabled:!u,running:c,thinking:1===r,onEdit:p.onEditPlayer1,onAvatarChange:p.onPlayer1AvatarChange},"player1"),null!=s&&(0,d.jsx)(eb,{containerRef:e.containerRef,visible:!0,playerId:s,onClose:p.onCancel})]})},eN=()=>(0,j.ZC)({container:{display:"flex",alignItems:"center",maxWidth:"min(90vw, 400px)",height:"3rem",width:"100%",margin:"auto"},player0:{flex:"1 1 0",display:"flex"},player1:{flex:"1 1 0",display:"flex"},versus:{flex:"0 0 auto",margin:"0 36px"}});var eS=n(82729),ew=n(94101);class eE{init(e){var t;this.canvas=e,window.addEventListener("resize",this.onresize),null===(t=this.canvas)||void 0===t||t.addEventListener("click",this.onclick),this.onresize()}reset(e){null!=e.GOMOKU_SIZE&&(this.GOMOKU_SIZE=e.GOMOKU_SIZE),null!=e.pieceDrawer&&(this.pieceDrawer=e.pieceDrawer),null!=e.styles&&(this.styles={...this.styles,...e.styles}),this.canvas!==e.canvas&&(console.log("destroying canvas"),this.destroy(),this.init(e.canvas)),this.onresize()}destroy(){var e;window.removeEventListener("resize",this.onresize),null===(e=this.canvas)||void 0===e||e.removeEventListener("click",this.onclick)}async draw(e){let{_drawingStatus:t}=this;if(t.drawing){t.requesting=!0,t.requestData=[e];return}t.drawing=!0,this.pieces=e;try{let{canvas:e,bufferCanvas:t}=this,n=null==e?void 0:e.getContext("2d");if(null==e||null==n)return;let{width:r,height:i}=e;t.width=r,t.height=i;let a=t.getContext("2d");null!=a?(a.clearRect(0,0,r,i),await this._drawAll(a),n.clearRect(0,0,r,i),n.drawImage(t,0,0)):(n.clearRect(0,0,r,i),await this._drawAll(n))}finally{t.drawing=!1,t.requesting&&(t.requesting=!1,await this.draw(...t.requestData))}}async _drawAll(e){this._drawBoard(e),this._drawLocatePoints(e),await this._drawPieces(e),this._drawLastPlacedHighlight(e),this._drawActivatedCellHighlight(e)}_drawBoard(e){let{lineWidth:t,farTop:n,farRight:r,farBottom:i,farLeft:a,gridSize:o,styles:s}=this,l=o+t;e.lineWidth=t,e.strokeStyle=s.gridLineColor,e.beginPath();for(let t=n;t<=i;t+=l)e.moveTo(t,a),e.lineTo(t,r);for(let t=a;t<=r;t+=l)e.moveTo(n,t),e.lineTo(i,t);e.closePath(),e.stroke()}_drawLocatePoints(e){let{lineWidth:t,GOMOKU_SIZE:n,styles:r}=this,i=n-1>>1,a=i%4==0?4:i%4,o=t+6>>1;e.fillStyle=r.locatePointColor;for(let t=a;t+1<n;t+=4)for(let r=a;r+1<n;r+=4){let{x:n,y:i}=this.position(t,r);e.beginPath(),e.arc(n,i,o,0,ew.QA,!1),e.closePath(),e.stroke(),e.fill()}}async _drawPieces(e){if(null==this.pieceDrawer)return;let{GOMOKU_SIZE:t,pieceDrawer:n,pieceRadius:r,pieces:i}=this,a=[],o=[];for(let{r:e,c:n,p:r}of i)if(e>=0&&e<t&&n>=0&&n<t){let t=this.position(e,n);0===r?a.push(t):1===r&&o.push(t)}await Promise.allSettled([n.drawPieces(e,0,r,a),n.drawPieces(e,1,r,o)])}_drawLastPlacedHighlight(e){let t=this.pieces.get(-1);if(void 0===t)return;let{r:n,c:r}=t,{GOMOKU_SIZE:i,pieceRadius:a,activateCell:o}=this;if((n!==o.r||r!==o.c)&&n>=0&&n<i&&r>=0&&r<i){let{x:t,y:i}=this.position(n,r);e.setLineDash([5,3]),e.lineWidth=1,e.strokeStyle="#c80000",e.beginPath(),e.arc(t,i,a+4,0,ew.QA,!1),e.closePath(),e.stroke(),e.setLineDash([])}}_drawActivatedCellHighlight(e){let{GOMOKU_SIZE:t,activateCell:n,pieceRadius:r}=this,{r:i,c:a}=n;if(i>=0&&i<t&&a>=0&&a<t){let{x:t,y:n}=this.position(i,a);e.setLineDash([5,3]),e.lineWidth=1,e.strokeStyle="blue",e.beginPath(),e.arc(t,n,r+4,0,ew.QA,!1),e.closePath(),e.stroke(),e.setLineDash([])}}locate(e,t){let{GOMOKU_SIZE:n,pieceRadius:r}=this,i=this.gridSize+this.lineWidth,a=e-this.farLeft,o=t-this.farTop,s=Math.floor(o/i),l=Math.floor(a/i),c=a-l*i,d=o-s*i;return 2*c>i&&(l+=1,c=i-c),2*d>i&&(s+=1,d=i-d),s>=0&&s<n&&l>=0&&l<n&&Math.abs(c)<=r&&Math.abs(d)<=r?{r:s,c:l}:{r:-1,c:-1}}position(e,t){let{lineWidth:n,gridSize:r,farLeft:i,farTop:a}=this,o=r+n;return{x:i+t*o,y:a+e*o}}updateActivateCell(e,t){this.activateCell.r=e,this.activateCell.c=t,this.draw(this.pieces)}constructor(e){var t,n,r,i,a;this.canvas=null,this.pieceDrawer=null,this.pieceRadius=0,this.gridSize=0,this.farTop=0,this.farRight=0,this.farBottom=0,this.farLeft=0,this.activateCell={r:-1,c:-1},this._drawingStatus={drawing:!1,requesting:!1,requestData:[b.aV.of()]},this.onresize=()=>{let{canvas:e,GOMOKU_SIZE:t,lineWidth:n}=this;if(null==e)return;let r=e.parentElement;if(null!=r){var i;let a=Math.min(r.clientWidth,r.clientHeight),o=n*t,s=Math.floor((a-o)/(t+.2));if(s<12)throw TypeError("Canvas is not large enough. clientWidth(".concat(r.clientWidth,"), clientHeight(").concat(r.clientHeight,")"));e.width=a,e.height=a;let l=a-o-s*(t-1);this.farLeft=this.farTop=Math.floor(l/2),this.farRight=this.farBottom=a-(l-this.farLeft),this.gridSize=s;let c=Math.round((this.lineWidth+16)/2)+1;this.pieceRadius=null!==(i=this.__customPieceRadius)&&void 0!==i?i:Math.floor(Math.min(.4*s,Math.max(.3*this.gridSize,c))),this.draw(this.pieces)}},this.onclick=e=>{let{GOMOKU_SIZE:t}=this,{offsetX:n,offsetY:r}=e,{r:i,c:a}=this.locate(n,r);if(i>=0&&i<t&&a>=0&&a<t){var o,s;this.updateActivateCell(i,a),null===(o=(s=this.listeners).onClick)||void 0===o||o.call(s,i,a)}},this.GOMOKU_SIZE=e.lines,this.pieces=e.pieces,this.lineWidth=null!==(r=e.lineWidth)&&void 0!==r?r:1,this.pieceDrawer=e.pieceDrawer,this.listeners={...e.listeners},this.bufferCanvas=document.createElement("canvas"),this.styles={gridLineColor:null!==(i=null===(t=e.styles)||void 0===t?void 0:t.gridLineColor)&&void 0!==i?i:"#492d15",locatePointColor:null!==(a=null===(n=e.styles)||void 0===n?void 0:n.locatePointColor)&&void 0!==a?a:"#333333"},this.__customPieceRadius=e.pieceRadius,this.init(e.canvas)}}var eR=n(6260);class ej{drawPieces(e,t,n,r){let i=2*n,{pieceFillStyle:a,pieceStrokeStyle:o}=this.getPreferenceSettings(t),s=null!=o?(0,j.xv)(o):"";switch(s&&(e.strokeStyle=s),a.prefer){case"color":for(let{x:t,y:i}of((0,eR.Z)(null!=a.color,"[drawPiece] color is not defined"),e.fillStyle=(0,j.xv)(a.color),r))e.beginPath(),e.arc(t,i,n,0,ew.QA,!1),e.closePath(),e.stroke(),e.fill();return Promise.resolve();case"image":{(0,eR.Z)(null!=a.imageUrl,"[drawPiece] imageUrl is not defined");let t=document.createElement("img");return t.src=a.imageUrl,new Promise(a=>{t.onload=()=>{for(let{x:a,y:o}of r)e.save(),e.beginPath(),e.arc(a,o,n,0,ew.QA,!1),e.closePath(),e.clip(),e.drawImage(t,0,0,t.width,t.height,a-n,o-n,i,i),e.restore();a()}})}default:return Promise.resolve()}}constructor(e){this.getPreferenceSettings=e}}new RegExp("^\\s*(\\d+(?:\\.\\d+)?)([".concat("KMGTP","]B?)?\\s*$"));let eM=e=>new Promise(t=>setTimeout(t,e));var e_=n(25289);class e${get isRunning(){return this._running}request(e){if(!this._running){var t;this._running=!0,null===(t=this._worker)||void 0===t||t.postMessage(e)}}constructor(e){if(this._running=!1,this._worker=null,e.canUseDOM&&"undefined"!=typeof Worker){let{scriptURL:t,options:n,onResponse:r}=e,i=new Worker(t,n);i.onmessage=e=>{this._running=!1,r(e)},this._worker=i}}}(c||(c={})).MOVE="move";let eT=new class{run(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,{_tasks:r,_taskMap:i,_previousTaskHolder:a}=this;return new Promise((o,s)=>{this._taskId+=1;let l={id:this._taskId,type:e,data:t,status:"pending",resolve:o,reject:s};r.enqueue(l),i.set(l.id,l);let c=a.get(n);void 0!==c&&"pending"===c.status&&(c.status="canceled",c.resolve(null),l.id=c.id),a.set(n,l),this._schedule()})}_schedule(){var e;let t;let n=this._workers.find(e=>!e.isRunning);if(void 0===n)return;let{_tasks:r}=this;for(;r.size>0&&"pending"!==(t=r.dequeue()).status;);(null===(e=t)||void 0===e?void 0:e.status)==="pending"&&(t.status="running",n.request({id:t.id,type:t.type,data:t.data}))}constructor(e){var t;let n=Math.max(1,Math.min(100,e.workerInstanceCount));this._requestId=0,this._taskId=0,this._tasks=new e_.T,this._taskMap=new Map,this._previousTaskHolder=new Map,this._tasks.init(),this._tasks.resize(null!==(t=e.MAX_TASK_NUMBER)&&void 0!==t?t:1e4),this._workers=Array(n).fill([]).map(()=>new e$({canUseDOM:e.canUseDOM,scriptURL:e.workerUrl,options:e.workerOptions,onResponse:e=>{let{id:t,data:n,error:r}=e.data,i=this._taskMap.get(t);switch((0,eR.Z)(void 0!==i,()=>"[Webworker] Cannot find the running task with id (".concat(t,")")),i.status){case"running":null===n?i.reject("[Webworker] Cannot solve the request. ".concat(r)):i.resolve(n),i.status="done";break;case"pending":case"done":throw Error("[Webworker] Bad task status (".concat(i.status,"). id (").concat(t,")"))}this._schedule()}}))}}({canUseDOM:ew.Nq,workerUrl:"/asset/js/webworker/gomoku.js",workerInstanceCount:1,MAX_TASK_NUMBER:10});async function eP(e){let t=await eT.run(c.MOVE,e);if(null===t)return[-1,-1];let{r:n,c:r}=t;return[n,r]}class eI{async move(e){let t=Date.now(),n=this._move(e),r=t+this.MINIMAL_THINKING_TIME-Date.now();return r>0&&await eM(r),n}constructor(e){var t;let n=Math.min(3e5,null!==(t=e.MINIMAL_THINKING_TIME)&&void 0!==t?t:0);this.MINIMAL_THINKING_TIME=n}}class eA extends eI{async _move(e){let{MAX_ROW:t,MAX_COL:n,pieces:r,playerId:i}=e,[a,o]=await eP({MAX_ROW:t,MAX_COL:n,pieces:Array.from(r),playerId:i,MAX_ADJACENT:this.MAX_ADJACENT,MAX_DISTANCE_OF_NEIGHBOR:this.MAX_DISTANCE_OF_NEIGHBOR});return[a,o]}constructor(e){super(e),this.type=l.COMPUTER,this.MAX_ADJACENT=e.MAX_ADJACENT,this.MAX_DISTANCE_OF_NEIGHBOR=e.MAX_DISTANCE_OF_NEIGHBOR,this.scoreMap=e.scoreMap}}class eD extends eI{_move(e){if(null!=e.clickedPos){let{r:t,c:n}=e.clickedPos;return[t,n]}return[-1,-1]}constructor(...e){super(...e),this.type=l.HUMAN}}var eO=n(66420);class eX extends eI{_move(e){let{MAX_ROW:t,MAX_COL:n}=e,r=Array.from(e.pieces);if(r.length<=0)return[t>>1,n>>1];for(let e of((0,eO.ZP)(r),(0,eO.ZP)(this.shufflableDirections),r))for(let[i,a]of this.shufflableDirections){let o=e.r+i,s=e.c+a;if(o>=0&&o<t&&s>=0&&s<n){if(r.some(e=>e.r===o&&e.c===s))continue;return[o,s]}}return[-1,-1]}constructor(e){super(e),this.type=l.STUPID_COMPUTER,this.shufflableDirections=k.bs.slice()}}let eU=e=>{switch(e.type){case l.HUMAN:return new eD({MINIMAL_THINKING_TIME:0});case l.COMPUTER:return new eA({MAX_ADJACENT:5,MAX_DISTANCE_OF_NEIGHBOR:2,MINIMAL_THINKING_TIME:300});case l.STUPID_COMPUTER:return new eX({MINIMAL_THINKING_TIME:300})}},eZ=()=>{var e;let t=v(),n=x(e=>e.status$),r=x(e=>e.MAX_ROW$),i=x(e=>e.MAX_COL$),a=x(e=>e.pieces$),s=x(e=>e.players$),l=x(e=>e.mover$),c=h.useRef([]);(null===(e=c.current[l])||void 0===e?void 0:e.type)!==s[l].type&&(c.current[l]=eU(s[l]));let d=c.current[l],u=h.useRef(!1),p=(0,R.$0)(async e=>{if(!u.current&&void 0!==d&&n===y.X.RUNNING)try{u.current=!0;let[n,s]=await d.move({MAX_ROW:r,MAX_COL:i,pieces:a,playerId:l,clickedPos:e});(0,eR.Z)(n>=0&&n<r&&s>=0&&s<=i,()=>"[Unexpected moving] currentPlayer(".concat(l,"}), moving: (").concat(n,", ").concat(s,")")),t({type:o.MOVE,payload:{r:n,c:s}})}catch(e){console.error("Failed to move:",e)}finally{u.current=!1,await eM(50)}}),m=N(d.type);return h.useEffect(()=>{if(!m||n!==y.X.RUNNING)return;let e=setTimeout(()=>void p(),0);return()=>clearTimeout(e)},[l,m,n,p]),{move:p}};function eG(){let e=(0,eS._)(["\n      position: relative;\n      box-sizing: content-box;\n      display: inline-block;\n      width: 100%;\n      height: 100%;\n      padding: 0;\n      border: 0;\n      margin: 0;\n      font-family: Consolas, 'Source Code Pro', 'Roboto Mono', monospace, sans-serif;\n    "]);return eG=function(){return e},e}function eF(){let e=(0,eS._)(["\n      z-index: 2;\n      position: absolute;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      display: none;\n      width: 100%;\n      height: 100%;\n      overflow: hidden;\n      background: linear-gradient(\n        45deg,\n        hsl(30deg 20% 90% / 0.2),\n        hsl(210deg 20% 100% / 0.3)\n      );\n    "]);return eF=function(){return e},e}function eL(){let e=(0,eS._)(["\n      && {\n        display: block;\n        backdrop-filter: blur(1px);\n      }\n    "]);return eL=function(){return e},e}function ez(){let e=(0,eS._)(["\n      && {\n        display: none;\n      }\n    "]);return ez=function(){return e},e}function eW(){let e=(0,eS._)(["\n      && {\n        display: block;\n        backdrop-filter: blur(4px);\n      }\n    "]);return eW=function(){return e},e}function eB(){let e=(0,eS._)(["\n      && {\n        display: block;\n        backdrop-filter: blur(4px);\n        color: #ff00ff;\n        animation: 1s 0s "," ease-in-out;\n      }\n    "]);return eB=function(){return e},e}function eH(){let e=(0,eS._)(["\n    0% {\n      transform: translate(0, -100px);\n    }\n    80% {\n      transform: translate(0, 20px);\n    }\n    90% {\n      transform: translate(0, -10px);\n    }\n    95% {\n      transform: translate(0, 2px);\n    }\n    100% {\n      transform: translate(0, 0);\n    }\n  "]);return eH=function(){return e},e}let eV=e=>{let{overlay:t,className:n}=e,r=x(e=>e.MAX_ROW$),i=x(e=>e.pieces$),a=x(e=>e.status$),o=x(e=>e.players$),{borderColor:s}=x(e=>e.preference$),l=h.useRef(null),c=(0,j.xv)(s),u=eZ(),p=(0,R.$0)((e,t)=>{e>=0&&e<r&&t>=0&&t<r&&u.move({r:e,c:t})}),m=(0,R.$0)(e=>o[e].preference),g=(0,R.$0)(async()=>{await (null==f?void 0:f.draw(i))}),[f,v]=h.useState(null);h.useEffect(()=>{let e=new ej(m),t=new eE({canvas:l.current,lines:15,pieces:b.aV.of(),pieceDrawer:e,listeners:{onClick:p}});return v(t),()=>t.destroy()},[p,m]),h.useEffect(()=>{null!=f&&(f.reset({canvas:l.current,GOMOKU_SIZE:r,styles:{gridLineColor:c}}),g())},[f,r,c,g]),h.useEffect(()=>{null==f||f.draw(i)},[f,i]);let y=eq();return(0,d.jsxs)("div",{className:(0,D.cx)(y.container,n),children:[(0,d.jsx)("div",{className:(0,D.cx)(y.overlay,y["overlay_".concat(a)]),children:t},"overlay"),(0,d.jsx)("canvas",{ref:l})]})},eq=()=>({container:(0,D.iv)(eG()),overlay:(0,D.iv)(eF()),["overlay_".concat(y.X.PENDING)]:(0,D.iv)(eL()),["overlay_".concat(y.X.RUNNING)]:(0,D.iv)(ez()),["overlay_".concat(y.X.PAUSED)]:(0,D.iv)(eW()),["overlay_".concat(y.X.END)]:(0,D.iv)(eB(),eY.finished)}),eY={finished:(0,D.F4)(eH())};var eK=n(9171),eQ=n(41616),eJ=n(70655),e0=n(1849);let e1=()=>{let e=v(),t=x(e=>e.attemptTick$),n=x(e=>e.winner$),r=x(e=>e.status$),i=x(e=>e.players$),a=i[n],s=t>0,l=(0,eK.D)();h.useEffect(()=>{s&&r===y.X.END&&void 0!==a&&l()},[s,r,a,l]);let c=e2();return h.useMemo(()=>{switch(r){case y.X.PENDING:return(0,d.jsx)("div",{className:c.overlay,children:(0,d.jsx)(G.Z,{className:c.button,variant:"contained",color:"primary",startIcon:(0,d.jsx)(eJ.Z,{}),onClick:()=>e({type:o.START}),children:"Start"})});case y.X.PAUSED:return(0,d.jsx)("div",{className:c.overlay,children:(0,d.jsx)(G.Z,{className:c.button,variant:"contained",color:"primary",startIcon:(0,d.jsx)(eQ.Z,{}),onClick:()=>e({type:o.RESUME}),children:"Resume"})});case y.X.END:return(0,d.jsx)("div",{className:c.overlay,children:(0,d.jsxs)("div",{className:c.finishedBanner,children:[void 0!==a?(0,d.jsxs)("div",{className:c.blessing,children:[(0,d.jsxs)("div",{className:c.winner,children:[(0,d.jsx)("span",{className:c.winnerAvatar,style:{background:(0,j.l9)(a.preference.pieceFillStyle),backgroundSize:"cover"}},"avatar"),(0,d.jsx)("span",{className:c.winnerName,children:a.name},"name")]}),"win\uD83C\uDF89"]}):(0,d.jsx)("p",{children:"Draw!"}),(0,d.jsx)(G.Z,{className:c.button,variant:"contained",color:"primary",startIcon:(0,d.jsx)(e0.Z,{}),onClick:()=>e({type:o.RESTART}),children:"New"})]})});default:return null}},[r,c,e,a])},e2=()=>h.useMemo(()=>(0,j.ZC)({overlay:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",height:"100%",width:"100%",userSelect:"none"},confettiCanvas:{top:0,bottom:0,left:0,right:0,width:"100%",height:"100%"},button:{"&&, &&:hover":{boxShadow:"4px 4px 16px 0px hsl(0deg 0% 0% / 0.75)"}},finishedBanner:{position:"relative",display:"flex",flexDirection:"column",justifyContent:"center",padding:0,margin:0,fontSize:32},blessing:{display:"flex",alignItems:"center",marginBottom:"1rem"},winner:{display:"flex",flexDirection:"column",alignItems:"center",marginRight:16},winnerAvatar:{display:"inline-block",width:32,height:32,borderRadius:"50%"},winnerName:{color:"#333",fontSize:12}}),[]);var e4=n(44993),e5=n(51334),e3=n(94229),e6=n(93946);let e8=["size","background","border"],e9={keys:e8,Component:e=>{let t=x(e=>e.status$),n=t===y.X.PENDING,r=t===y.X.END,i=h.useMemo(()=>({size:{label:"Size",disabled:!n,ContentRenderer:em({componentName:"GomokuSettingBoardSize",choices:Object.fromEntries([5,7,9,11,13,15,17,19,21,23,25].map(e=>[e,"".concat(e,"x").concat(e)])),normalize:e=>Number(e)})},background:{label:"Background",disabled:r,ContentRenderer:el({componentName:"GomokuSettingBoardBackground"})},border:{label:"Board",disabled:r,ContentRenderer:ed({componentName:"GomokuSettingBoardColor"})}}),[n,r]);return(0,d.jsx)(K,{data:e.data,items:i,itemsOrder:e8,classes:e7,onChange:e.onChange})}},e7=(0,j.ZC)({formItem:{margin:"1rem 1rem",alignItems:"center"},label:{minWidth:"6rem"}}),te=e=>{let t=v(),n=x(e=>e.status$),r=x(e=>e.MAX_ROW$),{boardBackground:i,borderColor:a}=x(e=>e.preference$),[s,l]=h.useState(!1),c=h.useMemo(()=>({size:T.MAX_ROW,background:T.preference.boardBackground,border:T.preference.borderColor}),[]),u=h.useMemo(()=>({size:r,background:i,border:a}),[r,i,a]),p=h.useMemo(()=>[e9],[]),m=n===y.X.END,g={onOpenDialog:(0,R.$0)(()=>l(!0)),onRealTimeChange:(0,R.$0)(e=>{r!==e.size&&t({type:o.RESET,payload:{MAX_ROW:e.size,MAX_COL:e.size}}),(i!==e.background||a!==e.border)&&t({type:o.MODIFY_PREFERENCE,payload:{boardBackground:e.background,borderColor:e.border}})}),onSave:e=>{g.onRealTimeChange(e),l(!1)},onDiscard:(0,R.$0)(e=>{g.onRealTimeChange(e),l(!1)})},{WakeBtn:f=tt}=e;return(0,d.jsxs)("div",{className:(0,D.cx)(tn.container,e.className),children:[(0,d.jsx)(f,{onWakeUp:g.onOpenDialog}),s&&(0,d.jsx)(ea,{container:e.containerRef.current,initialData:u,factoryData:c,isResetAvailable:!m,formGroups:p,classes:tr,onSave:g.onSave,onDiscard:g.onDiscard,onRealTimeChange:g.onRealTimeChange})]})},tt=e=>(0,d.jsx)(e6.Z,{size:"small",className:tn.wakeBtn,onClick:e.onWakeUp,children:(0,d.jsx)(e3.Z,{})}),tn=(0,j.ZC)({container:{},wakeBtn:{"> svg":{width:18,height:18}}}),tr=(0,j.ZC)({dialog:{minWidth:240,minHeight:400}}),ti=e=>{let t=v(),n=x(e=>e.status$),r=x(e=>e.mover$),i=x(e=>e.pieces$),[a,s]=h.useState(!1),l={flip:(0,R.$0)(()=>t({type:o.FLIP_PLAYER})),retract:(0,R.$0)(()=>t({type:o.RETRACT})),restart:(0,R.$0)(()=>{s(!1),t({type:o.RESTART})}),start:(0,R.$0)(()=>{n===y.X.PENDING||n===y.X.END?t({type:o.RESTART}):s(!0)}),closeDialog:(0,R.$0)(()=>s(!1))},c=ta(),u=n!==y.X.PENDING,p=(n===y.X.RUNNING||n===y.X.END)&&i.some(e=>e.p===r),m=n===y.X.PENDING;return(0,d.jsxs)("div",{className:c.toolbar,children:[(0,d.jsxs)("div",{className:(0,D.cx)(c.item,c.buttons),children:[(0,d.jsx)(G.Z,{variant:"contained",color:"inherit",size:"small",startIcon:(0,d.jsx)(e0.Z,{}),disabled:!u,onClick:l.start,children:(0,d.jsx)("span",{className:c.buttonText,children:"New"})}),(0,d.jsx)(G.Z,{variant:"contained",color:"inherit",size:"small",startIcon:(0,d.jsx)(e4.Z,{}),disabled:!p,onClick:l.retract,children:(0,d.jsx)("span",{className:c.buttonText,children:"Retract"})}),(0,d.jsx)(G.Z,{variant:"contained",color:"inherit",size:"small",startIcon:(0,d.jsx)(e5.Z,{}),disabled:!m,onClick:l.flip,children:(0,d.jsx)("span",{className:c.buttonText,children:"Flip"})}),(0,d.jsx)(te,{containerRef:e.containerRef})]}),(0,d.jsxs)(en.Z,{container:e.containerRef.current,open:a,onClose:()=>s(!1),"aria-labelledby":"confirm-to-restart",children:[(0,d.jsx)(er.Z,{children:"Are you sure you want to start a new game?"}),(0,d.jsxs)(ei.Z,{children:[(0,d.jsx)(G.Z,{color:"inherit",onClick:l.closeDialog,children:"Cancel"}),(0,d.jsx)(G.Z,{color:"primary",onClick:l.restart,children:"Confirm"})]})]})]})},ta=()=>(0,j.ZC)({toolbar:{display:"block",maxWidth:"min(90vw, 400px)",margin:"auto"},item:{display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"flex-start",margin:"1rem 0"},buttons:{justifyContent:"space-around","> button":{display:"flex",justifyContent:"spaceBetween",alignItems:"center",margin:"0 4px"}},buttonText:{lineHeight:1.1}}),to=()=>{let e=v(),t=h.useRef(null),n=ts();return(0,R.TK)(()=>e({type:o.PAUSE}),[e]),(0,d.jsxs)("div",{ref:t,className:n.container,children:[(0,d.jsxs)("div",{className:n.header,children:[(0,d.jsx)(eC,{containerRef:t}),(0,d.jsx)(ti,{containerRef:t})]}),(0,d.jsx)("div",{className:n.main,children:(0,d.jsx)(eV,{overlay:(0,d.jsx)(e1,{})})})]})},ts=()=>{let{boardBackground:e}=x(e=>e.preference$);return(0,j.ZC)({container:{boxSizing:"border-box",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:"100%"},header:{boxSizing:"border-box",display:"flex",flexDirection:"column",justifyContent:"center",width:"100%",padding:"2vmin"},main:{boxSizing:"border-box",height:"96vmin",width:"96vmin",background:(0,j.l9)(e),backgroundSize:"cover","@media (min-width: 1367px)":{width:"60vmin",height:"60vmin"}}})},tl=e=>(0,d.jsx)(I,{storageKey:e.storageKey,initialData:e.initialState,children:(0,d.jsx)(to,{})});tl.propTypes={storageKey:p().string.isRequired};var tc=n(64712),td=()=>{let e=h.useMemo(()=>({}),[]);return(0,d.jsx)(tc.V,{title:"Gomoku Game",children:(0,d.jsx)(tl,{initialState:e,storageKey:"@kyokuya/gomoku-game/context0/"})})}},74243:function(e,t,n){var r={"./component/container":[28195,195],"./component/container.tsx":[28195,195],"./component/editor":[70102,102],"./component/editor.tsx":[70102,102],"./component/previewer":[36040,468],"./component/previewer.tsx":[36040,468],"./post/algorithm/dlx/sudoku-solver":[15051,51],"./post/algorithm/dlx/sudoku-solver.tsx":[15051,51],"./post/game/sudoku":[71247,988,170,413,387,247],"./post/game/sudoku.tsx":[71247,988,170,413,387,247],"./util/sudoku":[34388,388],"./util/sudoku.ts":[34388,388]};function i(e){if(!n.o(r,e))return Promise.resolve().then(function(){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t});var t=r[e],i=t[0];return Promise.all(t.slice(1).map(n.e)).then(function(){return n(i)})}i.keys=function(){return Object.keys(r)},i.id=74243,e.exports=i}},function(e){e.O(0,[826,988,170,43,774,888,179],function(){return e(e.s=40193)}),_N_E=e.O()}]);